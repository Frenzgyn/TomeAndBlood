BACKUP ~TomeAndBlood/backup~
AUTHOR ~aquadrizzt@gmail.com~
VERSION ~0.4~ 

/* Language Settings */
AUTO_TRA ~TomeAndBlood/tra/%s~
LANGUAGE ~English~ ~english~ ~TomeAndBlood/tra/english/setup.tra~ 

// -----------------------------
// CORE REVISIONS
// -----------------------------
BEGIN @0
GROUP ~Core~ 
DESIGNATED 0 
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb00.qd~ //detection for this component 

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~
INCLUDE ~TomeAndBlood/data/core/arcanescrolls_list.tpa~ 
INCLUDE ~TomeAndBlood/lib/arcanespell_list.tpa~

COPY ~TomeAndBlood/data/core/CLABMA01.2DA~ ~override~ //new mage/sorcerer CLAB
	 ~TomeAndBlood/data/core/CLABMA02.2DA~ ~override~ //new abjurer CLAB
	 ~TomeAndBlood/data/core/CLABMA03.2DA~ ~override~ //new necromancer CLAB
	 ~TomeAndBlood/data/core/CLABMA04.2DA~ ~override~ //new transmuter CLAB
	 ~TomeAndBlood/data/core/CLABMA05.2DA~ ~override~ //new diviner CLAB
	 ~TomeAndBlood/data/core/CLABMA06.2DA~ ~override~ //new conjurer CLAB
	 ~TomeAndBlood/data/core/CLABMA07.2DA~ ~override~ //new invoker CLAB
	 ~TomeAndBlood/data/core/CLABMA08.2DA~ ~override~ //new illusionist CLAB
	 ~TomeAndBlood/data/core/CLABMA09.2DA~ ~override~ //new enchanter CLAB
	 ~TomeAndBlood/data/core/QDWILDMG.2DA~ ~override~ //new wild mage CLAB
	 ~TomeAndBlood/data/core/SPLSRCKN.2DA~ ~override~ //changes to known spells table
	 ~TomeAndBlood/data/core/MGSRCREQ.2DA~ ~override~ //prevent diviners
	 ~TomeAndBlood/data/core/CLABSO01.2DA~ ~override~ //new dragon disciple CLAB
	 
     ~TomeAndBlood/data/core/QDMLORE.SPL~ ~override~ //lore bonus spell 
     ~TomeAndBlood/data/core/QDMLOR1.EFF~ ~override~ //apply lore bonus 
     ~TomeAndBlood/data/core/QDMLOR1.SPL~ ~override~ //mage check, lore bonus
	 ~TomeAndBlood/data/core/QDSORC1.SPL~ ~override~ //-1 casting speed penalty
	 ~TomeAndBlood/data/core/QDSORC2.SPL~ ~override~ //-2 casting speed penalty
	 ~TomeAndBlood/data/core/QDSORC3.SPL~ ~override~ //-1 spell slot per level
	 ~TomeAndBlood/data/core/QDABJ01.SPL~ ~override~ //abjurer: +1 AC
	 ~TomeAndBlood/data/core/QDALT01.SPL~ ~override~ //transmuter: +1 save vs polymorph
	 ~TomeAndBlood/data/core/QDENC01.SPL~ ~override~ //enchanter: +1 save vs spell
	 ~TomeAndBlood/data/core/QDILL01.SPL~ ~override~ //illusionist: +1 save vs spell
	 ~TomeAndBlood/data/core/QDINV01.SPL~ ~override~ //invoker: +1 luck (min damage)
     ~TomeAndBlood/data/core/QDWLDMG.SPL~ ~override~ //wild mage: casting speed 
     ~TomeAndBlood/data/core/QDWLDMGA.EFF~ ~override~ //wild mage: casting speed eff 
     ~TomeAndBlood/data/core/QDWLDMGA.SPL~ ~override~ //wild mage: casting speed spl 
	 ~TomeAndBlood/data/core/QDELDA1.EFF~ ~override~ //eldritch: grant bloodline spells
	 ~TomeAndBlood/data/core/QDELDA1.SPL~ ~override~ //eldritch: sorcerer check, bloodline spells
	 ~TomeAndBlood/data/core/QDELDA2.EFF~ ~override~ //eldritch: apply casting speed penalty
	 ~TomeAndBlood/data/core/QDELDA2.SPL~ ~override~ //eldritch: sorcerer check, casting speed penalty

ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
	COPY ~TomeAndBlood/data/core/QDELD01_BG.SPL~ ~override/QDELD01.SPL~ //bloodline spells
END	ELSE
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
	COPY ~TomeAndBlood/data/core/QDELD01_IWD.SPL~ ~override/QDELD01.SPL~ //bloodline
END	
	 
COPY_EXISTING ~TomeAndBlood/data/core/QDFAMLR.SPL~ ~override~ //find familiar innate 
	 SAY NAME1 @1 
	 SAY UNIDENTIFIED_DESC @2 
	 
ACTION_IF GAME_IS ~bgee~ THEN BEGIN 
	STRING_SET ~24233~ @8 //new sorcerer description 
	STRING_SET ~32300~ @8 //new sorcerer description 
	STRING_SET ~31978~ @5 // new dragon disciple description
	STRING_SET ~9563~ @9 //new mage description
	STRING_SET ~17245~ @9 //new mage description
	STRING_SET ~9564~ @10 //new abjurer description
	STRING_SET ~24290~ @10 //new abjurer description
	STRING_SET ~9565~ @11 //new conjurer description
	STRING_SET ~24291~ @11 //new conjurer description
	STRING_SET ~9566~ @12 //new diviner description
	STRING_SET ~24292~ @12 //new diviner description
	STRING_SET ~9567~ @13 //new enchanter description
	STRING_SET ~24293~ @13 //new enchanter description
	STRING_SET ~9568~ @14 //new illusionist description
	STRING_SET ~24294~ @14 //new illusionist description
	STRING_SET ~9569~ @15 //new invoker description
	STRING_SET ~24295~ @15 //new invoker description
	STRING_SET ~9570~ @16 //new necromancer description
	STRING_SET ~24296~ @16 //new necromancer description
	STRING_SET ~9571~ @17 //new transmuter description
	STRING_SET ~24297~ @17 //new transmuter description
	STRING_SET ~24283~ @18 //new wild mage description
END

ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
	STRING_SET ~45866~ @8 //new sorcerer description 
	STRING_SET ~9563~ @9 //new mage description
	STRING_SET ~17245~ @9 //new mage description
	STRING_SET ~9564~ @10 //new abjurer description
	STRING_SET ~24290~ @10 //new abjurer description
	STRING_SET ~9565~ @11 //new conjurer description
	STRING_SET ~24291~ @11 //new conjurer description
	STRING_SET ~9566~ @12 //new diviner description
	STRING_SET ~24292~ @12 //new diviner description
	STRING_SET ~9567~ @13 //new enchanter description
	STRING_SET ~24293~ @13 //new enchanter description
	STRING_SET ~9568~ @14 //new illusionist description
	STRING_SET ~24294~ @14 //new illusionist description
	STRING_SET ~9569~ @15 //new invoker description
	STRING_SET ~24295~ @15 //new invoker description
	STRING_SET ~9570~ @16 //new necromancer description
	STRING_SET ~24296~ @16 //new necromancer description
	STRING_SET ~9571~ @17 //new transmuter description
	STRING_SET ~24297~ @17 //new transmuter description
	STRING_SET ~24283~ @18 //new wild mage description
	STRING_SET ~74304~ @5 // new dragon disciple description
END 

ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	STRING_SET ~34605~ @8 //new sorcerer description 
	STRING_SET ~37249~ @8 //new sorcerer description 
	STRING_SET ~37253~ @5 // new dragon disciple description
	STRING_SET ~9563~ @9 //new mage description
	STRING_SET ~10940~ @9 //new mage description
	STRING_SET ~17245~ @9 //new mage description
	STRING_SET ~37189~ @9 //new mage description
	STRING_SET ~37191~ @9 //new mage description
	STRING_SET ~9564~ @10 //new abjurer description
	STRING_SET ~37193~ @10 //new abjurer description
	STRING_SET ~9565~ @11 //new conjurer description
	STRING_SET ~37196~ @11 //new conjurer description
	STRING_SET ~9566~ @12 //new diviner description
	STRING_SET ~37199~ @12 //new diviner description
	STRING_SET ~9567~ @13 //new enchanter description
	STRING_SET ~37202~ @13 //new enchanter description
	STRING_SET ~9568~ @14 //new illusionist description
	STRING_SET ~37205~ @14 //new illusionist description
	STRING_SET ~9569~ @15 //new invoker description
	STRING_SET ~37208~ @15 //new invoker description
	STRING_SET ~9570~ @16 //new necromancer description
	STRING_SET ~37211~ @16 //new necromancer description
	STRING_SET ~9571~ @17 //new transmuter description
	STRING_SET ~37214~ @17 //new transmuter description
	STRING_SET ~37217~ @18 //new wild mage description
	STRING_SET ~34655~ @18 //new wild mage description
END

COPY_EXISTING ~MXSPLSRC.2DA~ ~override/MXSPLDD.2DA~ //dragon disciples know same number of spells
APPEND ~HIDESPL.2da~ ~SPWI123	1	0~ //removes find familiar from spell tables
APPEND ~HIDESPL.2da~ ~SPWI124	1	0~ //removes NRD from spell tables
APPEND ~HIDESPL.2da~ ~SPWI222	1	0~ //removes Chaos Shield from spell tables
APPEND ~HIDESPL.2da~ ~SPWI723	1	0~ //removes Improved Chaos Shield from spell tables

COPY_EXISTING ~SCRL6D.ITM~ ~override~ 
	WRITE_BYTE 0x29 ("0b11000000")
	WRITE_BYTE 0x2d ("0b00111111")
	WRITE_BYTE 0x2f ("0b01000000")

COPY_EXISTING KITLIST.2da override //changes to wild mage clab
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER kitlist 30 5  ~QDWILDMG~ // changing clab
  SET_2DA_ENTRIES_NOW kitlist cols
  PRETTY_PRINT_2DA
BUT_ONLY

COPY_EXISTING HPCLASS.2da override //changes to necromancer hp
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER hpclass 25 1  ~HPDD~ // changing conjurer hitdie to D6
  SET_2DA_ENTRY_LATER hpclass 30 1  ~HPDD~ // changing necromancer hitdie to D6
  SET_2DA_ENTRIES_NOW hpclass cols
  PRETTY_PRINT_2DA
BUT_ONLY	 

COPY_EXISTING CLSRCREQ.2DA override 
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER clsrcreq 3 1  ~0~ // disallow human diviners
  SET_2DA_ENTRY_LATER clsrcreq 3 2  ~0~ // disallow elf diviners
  SET_2DA_ENTRY_LATER clsrcreq 3 3  ~0~ // disallow half elf diviners
  SET_2DA_ENTRY_LATER clsrcreq 52 6  ~1~ // allow gnome sorcerers
  SET_2DA_ENTRY_LATER clsrcreq 53 6  ~1~ // allow gnome dragon disciples
  SET_2DA_ENTRIES_NOW clsrcreq cols
  PRETTY_PRINT_2DA
BUT_ONLY

COPY_EXISTING WEAPPROF.2da override //changes to dragon disciple weapons
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER weapprof 17 57  ~1~ // allow dragon disciples to use clubs
  SET_2DA_ENTRY_LATER weapprof 23 57  ~1~ // allow dragon disciples to use crossbows
  SET_2DA_ENTRY_LATER weapprof 17 4  ~1~ // allow mages to use clubs
  SET_2DA_ENTRY_LATER weapprof 23 4  ~1~ // allow mages to use crossbows
  SET_2DA_ENTRY_LATER weapprof 17 22  ~1~ // allow abjurers to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 23  ~1~ // allow conjurers to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 24  ~1~ // allow diviners to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 25  ~1~ // allow enchanters to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 26  ~1~ // allow illusionists to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 27  ~1~ // allow invokers to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 28  ~1~ // allow necromancers to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 29  ~1~ // allow transmuters to use clubs
  SET_2DA_ENTRY_LATER weapprof 17 53  ~1~ // allow wild mages to use clubs
  SET_2DA_ENTRY_LATER weapprof 23 22  ~1~ // allow abjurers to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 23  ~1~ // allow conjurers to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 24  ~1~ // allow diviners to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 25  ~1~ // allow enchanters to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 26  ~1~ // allow illusionists to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 27  ~1~ // allow invokers to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 28  ~1~ // allow necromancers to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 29  ~1~ // allow transmuters to use crossbows
  SET_2DA_ENTRY_LATER weapprof 23 53  ~1~ // allow wild mages to use crossbows
  SET_2DA_ENTRIES_NOW weapprof cols
  PRETTY_PRINT_2DA
BUT_ONLY
	
COPY_EXISTING ALIGNMNT.2da override //changes to dragon disciple alignments
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER alignmnt 54 5  ~0~ // not TN
  SET_2DA_ENTRIES_NOW alignmnt cols
  PRETTY_PRINT_2DA
BUT_ONLY

COPY_EXISTING ABCLASRQ.2da override //changes to dragon disciple and sorcerer ability reqs
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER abclasrq 54 1  ~0~ // no required strength
  SET_2DA_ENTRY_LATER abclasrq 54 2  ~0~ // no required dexterity
  SET_2DA_ENTRY_LATER abclasrq 54 3  ~12~ // min 12 constitution
  SET_2DA_ENTRY_LATER abclasrq 54 6  ~12~ // min 12 charisma
  SET_2DA_ENTRY_LATER abclasrq 47 6  ~12~ // min 12 charisma
  SET_2DA_ENTRIES_NOW abclasrq cols
  PRETTY_PRINT_2DA
BUT_ONLY

//updating schools and barred schools
ACTION_PHP_EACH arcanespell AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.spl~) BEGIN 
		COPY_EXISTING ~%ind%.spl~ ~override~ 
				
			PATCH_IF (res = 9) BEGIN //no school
				WRITE_BYTE 0x25 0 //change to unaffiliated 
				WRITE_LONG 0x1e ("0x00000100") //blocked: diviners 		  
			END
			
			PATCH_IF (res = 1) BEGIN //abjuration
				WRITE_SHORT 0x22 12 //update casting graphic
				WRITE_BYTE 0x25 1 //change to abjuration 
				WRITE_LONG 0x1e ("0x00001300") //blocked: diviners and enchanters, necromancers 
			END
			
			PATCH_IF (res = 2) BEGIN //alteration
				WRITE_SHORT 0x22 10 //update casting graphic
				WRITE_BYTE 0x25 8 //change to alteration 
				WRITE_LONG 0x1e ("0x00000d00") //blocked: diviners and illusionists, invokers
			END
			
			PATCH_IF (res = 3) BEGIN //conjuration
				WRITE_SHORT 0x22 14 //update casting graphic
				WRITE_BYTE 0x25 2 //change to conjuration 
				WRITE_LONG 0x1e ("0x00001500") //blocked: diviners and illusionists, necromancers
			END
			
			PATCH_IF (res = 4) BEGIN //divination
				WRITE_SHORT 0x22 16 //update casting graphic
				WRITE_BYTE 0x25 3 //change to divination 
				WRITE_LONG 0x1e ("0x00000100") //blocked: diviners
			END
			
			PATCH_IF (res = 5) BEGIN //enchantment
				WRITE_SHORT 0x22 11 //update casting graphic
				WRITE_BYTE 0x25 4 //change to enchantment 
				WRITE_LONG 0x1e ("0x00000940") //blocked: diviners and abjurers, invokers
			END
			
			PATCH_IF (res = 6) BEGIN //evocation
				WRITE_SHORT 0x22 15 //update casting graphic
				WRITE_BYTE 0x25 6 //change to evocation 
				WRITE_LONG 0x1e ("0x00002300") //blocked: diviners and enchanters, transmuters
			END
			
			PATCH_IF (res = 7) BEGIN //illusion
				WRITE_SHORT 0x22 13 //update casting graphic
				WRITE_BYTE 0x25 5 //change to illusion 
				WRITE_LONG 0x1e ("0x00002180") //blocked: diviners and conjurers, transmuters
			END
						PATCH_IF (res = 8) BEGIN //necromancy
				WRITE_SHORT 0x22 9 //update casting graphic
				WRITE_BYTE 0x25 7 //change to necromancy 
				WRITE_LONG 0x1e ("0x000001c0") //blocked: diviners and abjurers, conjurers
			END
			BUT_ONLY 
	END
END

ACTION_PHP_EACH arcanescroll AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.itm~) BEGIN 
		COPY_EXISTING ~%ind%.itm~ ~override~ 
				
			PATCH_IF (res = 9) BEGIN //no school
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 1) BEGIN //abjuration
				WRITE_BYTE 0x2d ("0x13") //blocked: diviners and enchanters, necromancers 	
				WRITE_BYTE 0x2f ("0x00") //clear				
			END
			
			PATCH_IF (res = 2) BEGIN //alteration
				WRITE_BYTE 0x2d ("0x0d") //blocked: diviners and illusionists, invokers 	
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 3) BEGIN //conjuration
				WRITE_BYTE 0x2d ("0x15") //blocked: diviners and illusionists, necromancers
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 4) BEGIN //divination
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners 		  
			END
			
			PATCH_IF (res = 5) BEGIN //enchantment
				WRITE_BYTE 0x2d ("0x09") //blocked: diviners and invokers		  
				WRITE_BYTE 0x2f ("0x40") //blocked: abjurers 		  
			END
			
			PATCH_IF (res = 6) BEGIN //evocation
				WRITE_BYTE 0x2d ("0x23") //blocked: diviners and enchanters, transmuters
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 7) BEGIN //illusion
				WRITE_BYTE 0x2d ("0x21") //blocked: diviners and transmuters 		  
				WRITE_BYTE 0x2f ("0x80") //blocked: conjurers
			END
			
			PATCH_IF (res = 8) BEGIN //necromancy
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners 		  
				WRITE_BYTE 0x2f ("0xc0") //blocked: abjurers and conjurers 		  
			END
			
	END
END

COPY_EXISTING ~SPWI123.SPL~ ~override~ //find familiar patch
	WRITE_BYTE 0x1e ("0b01000000")
	WRITE_BYTE 0x1f ("0b00111111")

COPY ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ABJ.SPL~ //making the new abjuration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ALT.SPL~ //making the new alteration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!CON.SPL~ //making the new conjuration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!EVO.SPL~ //making the new evocation spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ENC.SPL~ //making the new enchantment spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ILL.SPL~ //making the new illusion spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!NEC.SPL~ //making the new necromancy spell 

ACTION_PHP_EACH arcanespell AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.spl~) BEGIN 
					
		ACTION_IF (res = 1) BEGIN //abjuration
			COPY_EXISTING ~QDMG!ABJ.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 2) BEGIN //alteration
			COPY_EXISTING ~QDMG!ALT.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 3) BEGIN //conjuration
			COPY_EXISTING ~QDMG!CON.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 5) BEGIN //enchantment
			COPY_EXISTING ~QDMG!ENC.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 6) BEGIN //evocation
			COPY_EXISTING ~QDMG!EVO.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 7) BEGIN //illusion
			COPY_EXISTING ~QDMG!ILL.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 8) BEGIN //necromancy
			COPY_EXISTING ~QDMG!NEC.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END	
	END
END

	
COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_BYTE 0x31 "prof" ELSE 0
	
    PATCH_IF ("%prof%" = 103) BEGIN
      READ_BYTE 0x1f "fighter"
      PATCH_IF (("%fighter%" BAND "0b00001000") = "0b00000000") BEGIN 
        READ_BYTE   0x20 "mage"
        WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		END
	END 
	
	PATCH_IF ("%prof%" = 115) BEGIN
      READ_BYTE 0x1f "fighter"
      PATCH_IF (("%fighter%" BAND "0b00001000") = "0b00000000") BEGIN 
        READ_BYTE   0x20 "mage"
        WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		END
	END
	
	READ_SHORT 0x1c "type" ELSE 0
    PATCH_IF ("%type%" = 31) BEGIN
      READ_BYTE 0x1f "fighter"
      PATCH_IF (("%fighter%" BAND "0b00001000") = "0b00000000") BEGIN 
        READ_BYTE   0x20 "mage"
        WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		END
	END
END
BUT_ONLY 

COPY_EXISTING_REGEXP GLOB ~^.+\.cre$~ ~override~ //making diviners into regular mages 
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_LONG 0x244 "kit" ELSE 0
    PATCH_IF ("%kit%" = 0x01000000) BEGIN
        WRITE_LONG 0x244 ("%kit%" BAND "0x00000000")
	END
END
BUT_ONLY 

// -----------------------------
// NEW DD SUBCLASSES
// -----------------------------		

COPY ~TomeAndBlood/data/core/QDDDANC.CRE~ ~override~ //draconic ancestor creature

COPY ~TomeAndBlood/data/core/QDDDANC.SPL~ ~override~ //DD innate: declare ancestor
	SAY NAME1 @304
	SAY UNIDENTIFIED_DESC @305
	
//DD common  
COPY ~TomeAndBlood/data/core/QDDDCO1.SPL~ ~override~ //dragon disciple: +1 AC 
	 ~TomeAndBlood/data/core/QDDDCO2.SPL~ ~override~ //dragon disciple: +2 AC 
	 ~TomeAndBlood/data/core/QDDDCO3.SPL~ ~override~ //dragon disciple: 2d4 claws
	 ~TomeAndBlood/data/core/QDDDCO4.SPL~ ~override~ //dragon disciple: magic 2d4 claws
	 ~TomeAndBlood/data/core/QDDDCO5.SPL~ ~override~ //dragon disciple: 2d6 claws

//DD fire: red, gold, brass
	 ~TomeAndBlood/data/core/QDDDFI1.SPL~ ~override~ //dragon disciple: fire bloodline spells
	 ~TomeAndBlood/data/core/QDDDFI2.SPL~ ~override~ //dragon disciple: +10% fire res
	 ~TomeAndBlood/data/core/QDDDFI3.SPL~ ~override~ //dragon disciple: +15% fire res
	 ~TomeAndBlood/data/core/QDDDFI4.SPL~ ~override~ //dragon disciple: +25% fire res
	 ~TomeAndBlood/data/core/QDDDFI5.SPL~ ~override~ //dragon disciple: 2d6 + d6 fire claws 
	 	 
//DD acid: black, green, copper
	 ~TomeAndBlood/data/core/QDDDAC1.SPL~ ~override~ //dragon disciple: acid bloodline spells
	 ~TomeAndBlood/data/core/QDDDAC2.SPL~ ~override~ //dragon disciple: +10% acid res
	 ~TomeAndBlood/data/core/QDDDAC3.SPL~ ~override~ //dragon disciple: +15% acid res
	 ~TomeAndBlood/data/core/QDDDAC4.SPL~ ~override~ //dragon disciple: +25% acid res
	 ~TomeAndBlood/data/core/QDDDAC5.SPL~ ~override~ //dragon disciple: 2d6 + d6 acid claws 
	 
//DD electricity: blue, bronze
	 ~TomeAndBlood/data/core/QDDDEL1.SPL~ ~override~ //dragon disciple: electric bloodline spells
	 ~TomeAndBlood/data/core/QDDDEL2.SPL~ ~override~ //dragon disciple: +10% electric res
	 ~TomeAndBlood/data/core/QDDDEL3.SPL~ ~override~ //dragon disciple: +15% electric res
	 ~TomeAndBlood/data/core/QDDDEL4.SPL~ ~override~ //dragon disciple: +25% electric res
	 ~TomeAndBlood/data/core/QDDDEL5.SPL~ ~override~ //dragon disciple: 2d6 + d6 electric claws 
	 
//DD cold: silver, white
	 ~TomeAndBlood/data/core/QDDDCL1.SPL~ ~override~ //dragon disciple: cold bloodline spells
	 ~TomeAndBlood/data/core/QDDDCL2.SPL~ ~override~ //dragon disciple: +10% cold res
	 ~TomeAndBlood/data/core/QDDDCL3.SPL~ ~override~ //dragon disciple: +15% cold res
	 ~TomeAndBlood/data/core/QDDDCL4.SPL~ ~override~ //dragon disciple: +25% cold res
	 ~TomeAndBlood/data/core/QDDDCL5.SPL~ ~override~ //dragon disciple: 2d6 + cold d6 claws 

COPY ~TomeAndBlood/data/core/QDDDCO5.ITM~ ~override~ //dragon disciple: 2d6 claws itm
	 ~TomeAndBlood/data/core/QDDDCO3.ITM~ ~override~ //dragon disciple: 2d4 claws itm
	 ~TomeAndBlood/data/core/QDDDCO4.ITM~ ~override~ //dragon disciple: 2d4 claws +1 itm
	 ~TomeAndBlood/data/core/QDDDFI5.ITM~ ~override~ //dragon disciple: 2d6 + d6 fire claws itm
	 ~TomeAndBlood/data/core/QDDDAC5.ITM~ ~override~ //dragon disciple: 2d6 + d6 acid claws itm
	 ~TomeAndBlood/data/core/QDDDEL5.ITM~ ~override~ //dragon disciple: 2d6 + d6 electric claws itm
	 ~TomeAndBlood/data/core/QDDDCL5.ITM~ ~override~ //dragon disciple: 2d6 + cold d6 claws itm
		SAY NAME1 @430
	 
ADD_KIT ~QDDDBLA~
	~QDDDBLA 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDBLA 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDBLA 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDBLA 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDBLA 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDBLA 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDBLA 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDDDBLA 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDBLA.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @400
	SAY @401
	SAY @402

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@402)
		STR_VAR
			kit_name = QDDDBLA
			hpclass = HPDD
	END
END	
	
ADD_KIT ~QDDDBLU~
	~QDDDBLU 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDBLU 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDBLU 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDBLU 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDBLU 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDBLU 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDBLU 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDDDBLU 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDBLU.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @403
	SAY @404
	SAY @405

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@405)
		STR_VAR
			kit_name = QDDDBLU
			hpclass = HPDD
	END
END	

ADD_KIT ~QDDDGRE~
	~QDDDGRE 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDGRE 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDGRE 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDGRE 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDGRE 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDGRE 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDGRE 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDDDGRE 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDGRE.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @406
	SAY @407
	SAY @408

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@408)
		STR_VAR
			kit_name = QDDDGRE
			hpclass = HPDD
	END
END	

ADD_KIT ~QDDDRED~
	~QDDDRED 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDRED 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDRED 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDRED 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDRED 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDRED 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDRED 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDRED 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDRED.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @409
	SAY @410
	SAY @411

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@411)
		STR_VAR
			kit_name = QDDDRED
			hpclass = HPDD
	END
END	

ADD_KIT ~QDDDWHI~
	~QDDDWHI 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDWHI 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDWHI 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDWHI 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDWHI 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDWHI 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDWHI 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDWHI 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDWHI.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @412
	SAY @413
	SAY @414

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@414)
		STR_VAR
			kit_name = QDDDWHI
			hpclass = HPDD
	END
END	

ADD_KIT ~QDDDBRA~
	~QDDDBRA 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDBRA 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDBRA 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDBRA 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDBRA 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDBRA 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDBRA 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDBRA 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDBRA.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @415
	SAY @416
	SAY @417

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@417)
		STR_VAR
			kit_name = QDDDBRA
			hpclass = HPDD
	END
END	

ADD_KIT ~QDDDBRO~
	~QDDDBRO 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDBRO 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDBRO 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDBRO 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDBRO 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDBRO 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDBRO 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDBRO 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDBRO.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @418
	SAY @419
	SAY @420

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@420)
		STR_VAR
			kit_name = QDDDBRO
			hpclass = HPDD
	END
END

ADD_KIT ~QDDDCOP~
	~QDDDCOP 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDCOP 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDCOP 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDCOP 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDCOP 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDCOP 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDCOP 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDCOP 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDCOP.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @421
	SAY @422
	SAY @423

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@423)
		STR_VAR
			kit_name = QDDDCOP
			hpclass = HPDD
	END
END

ADD_KIT ~QDDDGOL~
	~QDDDGOL 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDGOL 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDGOL 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDGOL 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDGOL 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDGOL 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDGOL 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDGOL 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDGOL.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @424
	SAY @425
	SAY @426

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@426)
		STR_VAR
			kit_name = QDDDGOL
			hpclass = HPDD
	END
END

ADD_KIT ~QDDDSIL~
	~QDDDSIL 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDDSIL 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDDSIL 0 0 12 12 0 9~ //abclasrq.2da 
	~QDDDSIL 0 0 0 0 0 0~ //abclsmod.2da
	~QDDDSIL 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDDSIL 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDDSIL 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDDDSIL 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/core/QDDDSIL.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @427
	SAY @428
	SAY @429

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@429)
		STR_VAR
			kit_name = QDDDSIL
			hpclass = HPDD
	END
END

COMPILE ~TomeAndBlood/data/core/QDDDANC.D~ 
COMPILE ~TomeAndBlood/data/core/QDDDANC.BAF~ 

// -----------------------------
// DIVINE SPELLS AS ARCANE SPELLS
// -----------------------------	

//This code is adapted from Dib's Favoured Soul mod and is used with permission. 

COPY_EXISTING_REGEXP GLOB ~SPPR.*\.SPL~ ~.~
	INNER_PATCH_SAVE divinespell ~%SOURCE_FILE%~ BEGIN
		REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~SPPR~ ~QDPR~
	END 
	
INNER_ACTION BEGIN 
	COPY_EXISTING ~%SOURCE_FILE%~ ~override/%divinespell%~ 
		WRITE_SHORT 0x1c ~1~ //change to arcane
END 
BUT_ONLY

//-----------------------------
// COMPATIBILITY WITH MORE STYLE FOR WIZARDS by PECCA 
//-----------------------------

ACTION_IF FILE_EXISTS_IN_GAME ~WSSPELLS.SPL~ THEN BEGIN  //checking for MSFM 
	COMPILE ~TomeAndBlood/data/compatibility/QD_MSFM_fix_0.D~ 	 	
	COPY_EXISTING_REGEXP GLOB ~WSTAF.*\.ITM~ ~override~ 
		WRITE_BYTE 0x29 ~0x0~ 
		WRITE_BYTE 0x2d ~0x0~ 
		WRITE_BYTE 0x2f ~0x0~ 
		
END 

// -----------------------------
// SPELL SELECTION THROUGH DIALOGUE
// -----------------------------		
BEGIN @500
GROUP ~Functionality~ 
DESIGNATED 1
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100
REQUIRE_PREDICATE (GAME_IS ~bg2ee iwdee~) @501

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb01.qd~ //detection for this component 

COPY ~TomeAndBlood/data/spell_select/QDSPLSOR.CRE~ ~override~ //sorcerer spell creature

COPY ~TomeAndBlood/data/spell_select/QDSORSM.SPL~ ~override~ //sorcerer innate: spell knowledge
	SAY NAME1 @300
	SAY UNIDENTIFIED_DESC @301
	
COPY ~TomeAndBlood/data/spell_select/SPLSRCKN.2da~ ~override~ //spells sorcerer known = 0 ALL 

COPY_EXISTING ~QDDDBLA.2da~ ~override~ 
			  ~QDDDBLU.2da~ ~override~ 
			  ~QDDDGRE.2da~ ~override~ 
			  ~QDDDRED.2da~ ~override~ 
			  ~QDDDWHI.2da~ ~override~ 
			  ~QDDDBRA.2da~ ~override~ 
			  ~QDDDBRO.2da~ ~override~ 
			  ~QDDDCOP.2da~ ~override~ 
			  ~QDDDGOL.2da~ ~override~ 
			  ~QDDDSIL.2da~ ~override~ 
 
			INSERT_2DA_ROW 3 0 ~MEMORIZE 	GA_QDSORSM ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 

ACTION_IF (NOT FILE_EXISTS_IN_GAME ~qdtnb05.qd~) THEN BEGIN 
	COPY ~TomeAndBlood/data/spell_select/QDSORSA.SPL~ ~override~ //sorcerer check: spell knowledge
		 ~TomeAndBlood/data/spell_select/QDSORSA.EFF~ ~override~ //sorcerer check effect: spell knowledge
	
	COPY_EXISTING ~CLABMA01.2da~ ~override~ 
		INSERT_2DA_ROW 3 0 ~MEMORIZE GA_QDSORSM ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END

ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
	COMPILE ~TomeAndBlood/data/spell_select/bg2/QDSPLSOR.BAF~ 
	COMPILE ~TomeAndBlood/data/spell_select/bg2/QDSPLSOR.D~ 
END

ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	COMPILE ~TomeAndBlood/data/spell_select/iwd/QDSPLSOR.BAF~ 
	COMPILE ~TomeAndBlood/data/spell_select/iwd/QDSPLSOR.D~ 
END

// -----------------------------
// CHANGING SPELL SCHOOLS AND UPDATING SCROLLS
// -----------------------------		
BEGIN @690
GROUP ~Functionality~ 
DESIGNATED 2
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502	

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb02.qd~ //detection for this component

INCLUDE ~TomeAndBlood/data/school_update/arcanescrolls_list_update.tpa~
INCLUDE ~TomeAndBlood/data/school_update/arcanespell_list_update.tpa~

//updating schools and barred schools
ACTION_PHP_EACH arcanespell AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.spl~) BEGIN 
		COPY_EXISTING ~%ind%.spl~ ~override~ 
				
			PATCH_IF (res = 9) BEGIN //no school
				WRITE_BYTE 0x25 0 //change to unaffiliated 
				WRITE_LONG 0x1e ("0x00000100") //blocked: diviners 		  
			END
			
			PATCH_IF (res = 1) BEGIN //abjuration
				WRITE_SHORT 0x22 12 //update casting graphic
				WRITE_BYTE 0x25 1 //change to abjuration 
				WRITE_LONG 0x1e ("0x00001300") //blocked: diviners and enchanters, necromancers 
			END
			
			PATCH_IF (res = 2) BEGIN //alteration
				WRITE_SHORT 0x22 10 //update casting graphic
				WRITE_BYTE 0x25 8 //change to alteration 
				WRITE_LONG 0x1e ("0x00000d00") //blocked: diviners and illusionists, invokers
			END
			
			PATCH_IF (res = 3) BEGIN //conjuration
				WRITE_SHORT 0x22 14 //update casting graphic
				WRITE_BYTE 0x25 2 //change to conjuration 
				WRITE_LONG 0x1e ("0x00001500") //blocked: diviners and illusionists, necromancers
			END
			
			PATCH_IF (res = 4) BEGIN //divination
				WRITE_SHORT 0x22 16 //update casting graphic
				WRITE_BYTE 0x25 3 //change to divination 
				WRITE_LONG 0x1e ("0x00000100") //blocked: diviners
			END
			
			PATCH_IF (res = 5) BEGIN //enchantment
				WRITE_SHORT 0x22 11 //update casting graphic
				WRITE_BYTE 0x25 4 //change to enchantment 
				WRITE_LONG 0x1e ("0x00000940") //blocked: diviners and abjurers, invokers
			END
			
			PATCH_IF (res = 6) BEGIN //evocation
				WRITE_SHORT 0x22 15 //update casting graphic
				WRITE_BYTE 0x25 6 //change to evocation 
				WRITE_LONG 0x1e ("0x00002300") //blocked: diviners and enchanters, transmuters
			END
			
			PATCH_IF (res = 7) BEGIN //illusion
				WRITE_SHORT 0x22 13 //update casting graphic
				WRITE_BYTE 0x25 5 //change to illusion 
				WRITE_LONG 0x1e ("0x00002180") //blocked: diviners and conjurers, transmuters
			END
			
			PATCH_IF (res = 8) BEGIN //necromancy
				WRITE_SHORT 0x22 9 //update casting graphic
				WRITE_BYTE 0x25 7 //change to necromancy 
				WRITE_LONG 0x1e ("0x000001c0") //blocked: diviners and abjurers, conjurers
			END
			BUT_ONLY 
	END
END

//updating the descriptions of spells with changed schools
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI103.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI103.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @700 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI105.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI105.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @701
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI106.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI106.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @702 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI114.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI114.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @703 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI115.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI115.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @704 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI125.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI125.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @705 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI213.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI213.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @706 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI215.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI215.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @707 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI220.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI220.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @708 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI221.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI221.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @709 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI223.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI223.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @710 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI226.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI226.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @711 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI303.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI303.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @712 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI315.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI315.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @713 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI402.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI402.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @714 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI417.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI417.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @715 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI421.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI421.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @716 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI502.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI502.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @717 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI514.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI514.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @718 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI612.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI612.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @719 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI617.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI617.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @720 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI632.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI632.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @721 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI704.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI704.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @722 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI710.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI710.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @723 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI714.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI714.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @724 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI715.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI715.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @725 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI722.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI722.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @726 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI809.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI809.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @727 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI810.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI810.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @728 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI811.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI811.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @729 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI815.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI815.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @730 
END 
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI816.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI816.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @731 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI817.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI817.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @732 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI908.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI908.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @733 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI912.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI912.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @734 
END 

ACTION_IF FILE_EXISTS_IN_GAME ~SPWI919.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI919.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @735 
END 
	
ACTION_IF FILE_EXISTS_IN_GAME ~SPWI420.SPL~ THEN BEGIN 
	COPY_EXISTING ~SPWI420.SPL~ ~override~ 
		SAY UNIDENTIFIED_DESC @736
END 

//updating spell selection dialogues
ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb01.qd~) THEN BEGIN 
	ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
		COMPILE ~TomeAndBlood/data/school_update/bg2/QDSPLSOR.D~ 
	END

	ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
		COMPILE ~TomeAndBlood/data/school_update/iwd/QDSPLSOR.D~ 
	END	
END

//updating scrolls 
ACTION_PHP_EACH arcanescroll AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.itm~) BEGIN 
		COPY_EXISTING ~%ind%.itm~ ~override~ 
				
			PATCH_IF (res = 9) BEGIN //no school
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners 		  
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 1) BEGIN //abjuration
				WRITE_BYTE 0x2d ("0x13") //blocked: diviners and enchanters, necromancers 		  
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 2) BEGIN //alteration
				WRITE_BYTE 0x2d ("0x0d") //blocked: diviners and illusionists, invokers 		  
				WRITE_BYTE 0x2f ("0x00") //clear	
			END
			
			PATCH_IF (res = 3) BEGIN //conjuration
				WRITE_BYTE 0x2d ("0x15") //blocked: diviners and illusionists, necromancers
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 4) BEGIN //divination
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners 		  
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 5) BEGIN //enchantment
				WRITE_BYTE 0x2d ("0x09") //blocked: diviners and invokers		  
				WRITE_BYTE 0x2f ("0x40") //blocked: abjurers 		  
			END
			
			PATCH_IF (res = 6) BEGIN //evocation
				WRITE_BYTE 0x2d ("0x23") //blocked: diviners and enchanters, transmuters
				WRITE_BYTE 0x2f ("0x00") //clear
			END
			
			PATCH_IF (res = 7) BEGIN //illusion
				WRITE_BYTE 0x2d ("0x21") //blocked: diviners and transmuters 		  
				WRITE_BYTE 0x2f ("0x80") //blocked: conjurers
			END
			
			PATCH_IF (res = 8) BEGIN //necromancy
				WRITE_BYTE 0x2d ("0x01") //blocked: diviners 		  
				WRITE_BYTE 0x2f ("0xc0") //blocked: abjurers and conjurers 		  
			END
			BUT_ONLY 
	END
END

//updating the spell removal spells
COPY ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ABJ.SPL~ //making the new abjuration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ALT.SPL~ //making the new alteration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!CON.SPL~ //making the new conjuration spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!EVO.SPL~ //making the new evocation spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ENC.SPL~ //making the new enchantment spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!ILL.SPL~ //making the new illusion spell 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!SCH.SPL~ ~override/QDMG!NEC.SPL~ //making the new necromancy spell 

ACTION_PHP_EACH arcanespell AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.spl~) BEGIN 
					
		ACTION_IF (res = 1) BEGIN //abjuration
			COPY_EXISTING ~QDMG!ABJ.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 2) BEGIN //alteration
			COPY_EXISTING ~QDMG!ALT.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 3) BEGIN //conjuration
			COPY_EXISTING ~QDMG!CON.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 5) BEGIN //enchantment
			COPY_EXISTING ~QDMG!ENC.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 6) BEGIN //evocation
			COPY_EXISTING ~QDMG!EVO.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 7) BEGIN //illusion
			COPY_EXISTING ~QDMG!ILL.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END
		
		ACTION_IF (res = 8) BEGIN //necromancy
			COPY_EXISTING ~QDMG!NEC.SPL~ ~override~ 
			LPF ADD_SPELL_EFFECT INT_VAR opcode=172 target=1 timing=9 STR_VAR resource= EVAL ~%ind%~ END 
		END	
	END
END
// -----------------------------
// ARMORED CASTING 
// -----------------------------		
BEGIN @510
GROUP ~Functionality~ 
DESIGNATED 3
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb03.qd~ //detection for this component 

//This component utilizes code by Mike1072, author of the Item Revisions mod.
//It is duplicated here, with permission from the author.

INCLUDE ~TomeAndBlood/data/armored_casting/armor_list.tpa~
INCLUDE ~TomeAndBlood/data/armored_casting/shield_list.tpa~

APPEND ~SPECIFIC.IDS~ ~200	ARMORED_CASTING_NO~ //no armor proficiency
APPEND ~SPECIFIC.IDS~ ~201	ARMORED_CASTING_LT~ //light armor proficiency
APPEND ~SPECIFIC.IDS~ ~202	ARMORED_CASTING_MD~ //medium armor proficiency
APPEND ~SPECIFIC.IDS~ ~203 	ARMORED_CASTING_HV~ //heavy armor proficiency 

COPY_EXISTING ~CLABBA01.2da~ ~override~ //bard kit
			  ~CLABBA02.2da~ ~override~ //blade
			  ~CLABBA03.2da~ ~override~ //jester
			  ~CLABBA04.2da~ ~override~ //skald 

				INSERT_2DA_ROW 3 0 ~AMRCAST AP_QDACLT ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 

COPY_EXISTING ~CLABMA01.2da~ ~override~ //mage/sorcerer 
			  ~CLABMA02.2da~ ~override~ //abjurer
			  ~CLABMA03.2da~ ~override~ //necromancer
			  ~CLABMA04.2da~ ~override~ //transmuter
			  ~CLABMA05.2da~ ~override~ //diviner
			  ~CLABMA06.2da~ ~override~ //conjurer
			  ~CLABMA07.2da~ ~override~ //invoker
			  ~CLABMA08.2da~ ~override~ //illusionist
			  ~CLABMA09.2da~ ~override~ //enchanter
			  ~CLABSO01.2da~ ~override~ //dragon disciple
			  ~QDDDBLA.2da~ ~override~ //dragon disciple black
			  ~QDDDBLU.2da~ ~override~ //dragon disciple blue
			  ~QDDDGRE.2da~ ~override~ //dragon disciple green
			  ~QDDDRED.2da~ ~override~ //dragon disciple red
			  ~QDDDWHI.2da~ ~override~ //dragon disciple white
			  ~QDDDBRA.2da~ ~override~ //dragon disciple brass
			  ~QDDDBRO.2da~ ~override~ //dragon disciple bronze
			  ~QDDDCOP.2da~ ~override~ //dragon disciple copper
			  ~QDDDGOL.2da~ ~override~ //dragon disciple gold
			  ~QDDDSIL.2da~ ~override~ //dragon disciple silver
			  
			  INSERT_2DA_ROW 3 0 ~AMRCAST AP_QDACNO ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
			  
COPY ~TomeAndBlood/data/armored_casting/QDARCBLK.EFF~ ~override~ //blocking effect 
	 ~TomeAndBlood/data/armored_casting/QDACNO.SPL~ ~override~ //sets Armored Casting to none 
	 ~TomeAndBlood/data/armored_casting/QDACLT.SPL~ ~override~ //sets Armored Casting to light 
	 ~TomeAndBlood/data/armored_casting/QDACMD.SPL~ ~override~ //sets Armored Casting to medium
	 ~TomeAndBlood/data/armored_casting/QDACHV.SPL~ ~override~ //sets Armored Casting to heavy  

//updates existing NPC bards/sorcerers/mages 
COPY_EXISTING_REGEXP GLOB ~^.+\.cre$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_SHORT 0x273 "class" ELSE 0
    PATCH_IF ("%class%" = 5) BEGIN //bard
		READ_BYTE  0x274 "specific"
        WRITE_BYTE 0x274 201 //light armor 
		END
	PATCH_IF ("%class%" = 1 || "%class%" = 19) BEGIN //mage and sorcerer
		READ_BYTE  0x274 "specific"
        WRITE_BYTE 0x274 200 //no armor
		END
	END
BUT_ONLY 

//Allows Bards, Mages and Sorcerers to wear helmets. 
COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_SHORT 0x1c "type" ELSE 0
    PATCH_IF ("%type%" = 7) BEGIN //helmets
      READ_BYTE 0x1e "bard"
	  READ_BYTE 0x1f "fighter"
      PATCH_IF (("%fighter%" BAND "0b00001000") = "0b00000000") BEGIN 
        READ_BYTE   0x20 "mage"
        WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		WRITE_BYTE 0x1e ("%bard%" BAND "0b10111111")
		END	
	END
END
BUT_ONLY 

//This code is adapted from Item Revisions and is used with permission from Mike1072 

ACTION_PHP_EACH armor AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.itm~) BEGIN 
		COPY_EXISTING ~%ind%.itm~ ~override~ 
			PATCH_IF (SOURCE_SIZE>0x71) BEGIN
				LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 60 END 
				LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 145 END
			END	

			READ_BYTE   0x20 "mage"
			WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")

			is_elven = (res >> 5) & 1
			armor_type = res & 7 
			
			PATCH_IF (is_elven = 0 && (armor_type = 1 || armor_type = 2)) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
			
			PATCH_IF (is_elven = 0 && (armor_type = 3 || armor_type = 4)) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 201 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
			
			PATCH_IF (is_elven = 0 && (armor_type = 5 || armor_type = 6 || armor_type = 7)) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 201 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 202 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
	END
END

ACTION_PHP_EACH shield AS ind => res BEGIN 
	ACTION_IF (FILE_EXISTS_IN_GAME ~%ind%.itm~) BEGIN 
		COPY_EXISTING ~%ind%.itm~ ~override~ 
			PATCH_IF (SOURCE_SIZE>0x71) BEGIN
				LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 60 END 
				LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 145 END
			END	

			READ_BYTE   0x20 "mage"
			WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		
			PATCH_IF (res = 1 || res = 2) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
			
			PATCH_IF (res = 3) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 201 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
			
			PATCH_IF (res = 4) BEGIN 
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 200 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 201 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
				LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 timing = 2 parameter1 = 202 parameter2 = 6 STR_VAR resource = EVAL ~QDARCBLK~ END 						
			END
	END
END

ACTION_IF GAME_IS ~bgee~ THEN BEGIN 
	STRING_SET ~24233~ @800 //new sorcerer description 
	STRING_SET ~32300~ @800 //new sorcerer description 
	STRING_SET ~9563~ @801 //new mage description
	STRING_SET ~17245~ @801 //new mage description

END

ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
	STRING_SET ~45866~ @800 //new sorcerer description
	STRING_SET ~9563~ @801 //new mage description
	STRING_SET ~17245~ @801 //new mage description

END

ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	STRING_SET ~34605~ @800 //new sorcerer description 
	STRING_SET ~37249~ @800 //new sorcerer description 
	STRING_SET ~9563~ @801 //new mage description
	STRING_SET ~10940~ @801 //new mage description
	STRING_SET ~17245~ @801 //new mage description
	STRING_SET ~37189~ @801 //new mage description
	STRING_SET ~37191~ @801 //new mage description
END

// -----------------------------
// ALLOW MAGES AND SORCERERS TO USE ALL WEAPONS 
// -----------------------------		
BEGIN @520
GROUP ~Functionality~ 
DESIGNATED 4
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb04.qd~ //detection for this component


COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_SHORT 0x31 "prof" ELSE 0
	READ_SHORT 0x1c "type" ELSE 0
    PATCH_IF ("%prof%" = 89 || //bastard sword
			  "%prof%" = 90 || //long sword
			  "%prof%" = 91 || //short sword
			  "%prof%" = 92 || //axe
			  "%prof%" = 93 || //2h sword
			  "%prof%" = 94 || //katana
			  "%prof%" = 95 || //scimitar 
			  "%prof%" = 97 || //war hammer
			  "%prof%" = 98 || //spear
			  "%prof%" = 99 || //halberd
			  "%prof%" = 100 || //flail/morningstar
			  "%prof%" = 101 || //mace
			  "%prof%" = 104 || //long bow
			  "%prof%" = 105 || //shortbow
			  "%type%" = 5) BEGIN //arrows
      READ_BYTE 0x1f "fighter"
      PATCH_IF (("%fighter%" BAND "0b00001000") = "0b00000000") BEGIN 
        READ_BYTE   0x20 "mage"
        WRITE_BYTE 0x20 ("%mage%" BAND "0b11111011")
		END	
	END
END
BUT_ONLY 

// -----------------------------
// ARCANE CRAFTING (BY GRAMMARSALAD)
// -----------------------------		
BEGIN @1001
GROUP ~Functionality~ 
DESIGNATED 5
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb05.qd~ //detection for this component

//The code below is by Grammarsalad and use with permission. 
////////////////////////////////////////////////////////////////
/////////////////         Craft Wand        ////////////////////
////////////////////////////////////////////////////////////////

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wand1.spl~ ~override~
  SAY NAME1 @115020//Craft Wand
  SAY UNIDENTIFIED_DESC @115021

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd01.itm~ ~override~
  SAY NAME1 #6689//Magic Missile
  SAY UNIDENTIFIED_DESC #17652
  
COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd02.itm~ ~override~
  SAY NAME1 #6692//Sleep
  SAY UNIDENTIFIED_DESC #17657

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd03.itm~ ~override~
  SAY NAME1 #6659//Fear
  SAY UNIDENTIFIED_DESC #17287

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd04.itm~ ~override~
  SAY NAME1 #7272//Monster Summoning
  SAY UNIDENTIFIED_DESC #19034

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd05.itm~ ~override~
  SAY NAME1 #7268//Fire
  SAY UNIDENTIFIED_DESC #17654

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd06.itm~ ~override~
  SAY NAME1 #6690//Paralyzation
  SAY UNIDENTIFIED_DESC #17653

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd07.itm~ ~override~
  SAY NAME1 #7270//Lightning
  SAY UNIDENTIFIED_DESC #17656
  
COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd08.itm~ ~override~
  SAY NAME1 #35943//Frost
  SAY UNIDENTIFIED_DESC #35944

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd09.itm~ ~override~
  SAY NAME1 #35947//Spell Striking
  SAY UNIDENTIFIED_DESC #35944

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd10.itm~ ~override~
  SAY NAME1 @115125//Armory
  SAY UNIDENTIFIED_DESC @115126

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd11.itm~ ~override~
  SAY NAME1 #17625//Freezing Death
  SAY UNIDENTIFIED_DESC @115118

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd12.itm~ ~override~ //Recharge original Freezing Death Wand
  SAY NAME1 #17625//Freezing Death
  SAY UNIDENTIFIED_DESC @115119

//Freezing Death for BGEE(2)
COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd13.itm~ ~override~ //Recharge original Freezing Death Wand
  SAY NAME1 @115121//Freezing Death
  SAY UNIDENTIFIED_DESC @115120

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd14.itm~ ~override~ //
  SAY NAME1 @115136//Polymorph other
  SAY UNIDENTIFIED_DESC @115137

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd15.itm~ ~override~ //
  SAY NAME1 @115144//cursing
  SAY UNIDENTIFIED_DESC @115145

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd16.itm~ ~override~ //
  SAY NAME1 @115146//Wand of Corrosion
  SAY UNIDENTIFIED_DESC @115147
  
COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd17.itm~ ~override~ //player created version
  SAY NAME1 @115146//Wand of Corrosion
  SAY UNIDENTIFIED_DESC @115148


//Wand of corrosion for BGEE(2)

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd18.itm~ ~override~ //player created version
  SAY NAME1 @115146//Wand of Corrosion
  SAY UNIDENTIFIED_DESC @115149

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wnd19.itm~ ~override~ //
  SAY NAME1 @115154//Wand of Cloudkill
  SAY UNIDENTIFIED_DESC @115155

//IWDEE ONLY
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/iwd/b_wand1.baf~ ~override~
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/iwd/b_wand1.d~ ~override~
END
//END IWDEE

//BGEE ONLY
ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/bg/b_wand1.baf~ ~override~
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/bg/b_wand1.d~ ~override~
END
//END BGEE

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_wand1.cre~ ~override~

////////////////////////////////////////////////////////////////
/////////////////      Recharge Wand        ////////////////////
////////////////////////////////////////////////////////////////
COPY_EXISTING ~WAND02.itm~ ~override~
  WRITE_SHORT 0x94 24   //Wand of fear 24 charges

COPY_EXISTING ~WAND03.itm~ ~override~
  WRITE_SHORT 0x94 60   //Wand of magic missile 60 charges

COPY_EXISTING ~WAND04.itm~ ~override~
  WRITE_SHORT 0x94 8   //Wand of paralysis missile 8 charges

COPY_EXISTING ~WAND05.itm~ ~override~
  WRITE_SHORT 0x94 15   //Wand of fire 15 charges
  WRITE_SHORT 0xCC 15   //Wand of fire 15 charges

COPY_EXISTING ~WAND06.itm~ ~override~
  WRITE_SHORT 0x94 8   //Wand of frost 8 charges

COPY_EXISTING ~WAND07.itm~ ~override~
  WRITE_SHORT 0x94 15   //Wand of Lightning 15 charges

COPY_EXISTING ~WAND08.itm~ ~override~
  WRITE_SHORT 0x94 60   //

//BGEE only
ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
  COPY_EXISTING ~WAND09.itm~ ~override~
    WRITE_SHORT 0x94 10   //
  COPY_EXISTING ~WAND13.itm~ ~override~
    WRITE_SHORT 0x94 8   //Wand of Cloudkill 10 charges
	
	
COPY_EXISTING ~WAND99.itm~ ~override~
  WRITE_SHORT 0x94 60   //Wand of magic missile 60 charges
  
END//End BGEE ONLY

COPY_EXISTING ~WAND10.itm~ ~override~
  WRITE_SHORT 0x94 15   //Wand of Mon Sum 15 charges
  
COPY_EXISTING ~WAND12.itm~ ~override~
  WRITE_SHORT 0x94 60   //Wand of magic missile 60 charges

//BGEE only
//End BGEE ONLY

COPY_EXISTING ~WAND18.itm~ ~override~
  WRITE_SHORT 0x94 7   //Wand of Spell Striking 7 charges
  WRITE_SHORT 0xCC 7   //Wand of Spell Striking 7 charges

COPY_EXISTING ~WAND19.itm~ ~override~
  WRITE_SHORT 0x94 7   //Wand of Cursing 7 charges

//IWDEE ONLY
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
  COPY_EXISTING ~WANDARM.itm~ ~override~
    WRITE_SHORT 0x94 10   //Wand of Armory 10 charges
    WRITE_SHORT 0xCC 10

  COPY_EXISTING ~WANDFAK.itm~ ~override~
    WRITE_SHORT 0x94 15  //Wand of Lightning 15 charges

  COPY_EXISTING ~WANDREA.itm~ ~override~
    WRITE_SHORT 0x94 15  //Wand of Lightning 15 charges
END
//END IWDEE ONLY


COPY ~TomeAndBlood/data/arcane_crafting/wand/b_rech1.spl~ ~override~
  SAY NAME1 @115038//Recharge Wands
  SAY UNIDENTIFIED_DESC @115039

//IWDEE ONLY
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/iwd/b_rech1.baf~ ~override~
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/iwd/b_rech1.d~ ~override~
END
//END IWDEE ONLY

//BGEE ONLY
ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/bg/b_rech1.baf~ ~override~
  COMPILE ~TomeAndBlood/data/arcane_crafting/wand/bg/b_rech1.d~ ~override~
END
//END BGEE ONLY

COPY ~TomeAndBlood/data/arcane_crafting/wand/b_rech1.cre~ ~override~


////////////////////////////////////////////////////////////////
/////////////////        Scribe Scroll      ////////////////////
/////////////////         All Versions      ////////////////////
////////////////////////////////////////////////////////////////
//Items: for all versions
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr01.bam~ ~override~  //NRD
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr01.itm~ ~override~
  SAY NAME1 @115027//NRD
  SAY UNIDENTIFIED_DESC @115028
  
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr02.bam~ ~override~  //Chaos Shield
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr02.itm~ ~override~
  SAY NAME1 @115029//CS
  SAY UNIDENTIFIED_DESC @115030

COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr03.bam~ ~override~  //Improved Chaos Shield
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scr03.itm~ ~override~
  SAY NAME1 @115031//ICS
  SAY UNIDENTIFIED_DESC @115032


////////////////////////////////////////////////////////////////
/////////////////        Scribe Scroll      ////////////////////
/////////////////         Just Gold         ////////////////////
////////////////////////////////////////////////////////////////
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scrib.spl~ ~override~   //Scribe Spl
  SAY NAME1 @115003//Scribe Scroll
  SAY UNIDENTIFIED_DESC @115017


COMPILE ~TomeAndBlood/data/arcane_crafting/scroll/b_scrib.baf~ ~override~   //Scribe script
COMPILE ~TomeAndBlood/data/arcane_crafting/scroll/b_scrib.d~ ~override~     //Scribe dlg
COPY ~TomeAndBlood/data/arcane_crafting/scroll/b_scrib.cre~ ~override~      //scribe creature

////////////////////////////////////////////////////////////////
/////////////////         Brew Potion       ////////////////////
////////////////////////////////////////////////////////////////

COPY ~TomeAndBlood/data/arcane_crafting/potion/b_Brew1.spl~ ~override~
  SAY NAME1 @115025//Brew Potion
  SAY UNIDENTIFIED_DESC @115254
COMPILE ~TomeAndBlood/data/arcane_crafting/potion/b_Brew1.baf~ ~override~
COMPILE ~TomeAndBlood/data/arcane_crafting/potion/b_Brew1.d~ ~override~
COPY ~TomeAndBlood/data/arcane_crafting/potion/b_Brew1.cre~ ~override~

//The code above is by Grammarsalad and use with permission.  


COPY ~TomeAndBlood/data/arcane_crafting/scroll/QDSCRCK.spl~ ~override~  //scribe mage only
COPY ~TomeAndBlood/data/arcane_crafting/scroll/QDSCRCK.EFF~ ~override~  //scribe mage only

//adding craft wands to mages and sorcerers

//mages get scribe scroll, potion and craft wand
COPY_EXISTING ~CLABMA02.2da~ ~override~ //abjurer
			  ~CLABMA03.2da~ ~override~ //necromancer
			  ~CLABMA04.2da~ ~override~ //transmuter
			  ~CLABMA05.2da~ ~override~ //diviner
			  ~CLABMA06.2da~ ~override~ //conjurer
			  ~CLABMA07.2da~ ~override~ //invoker
			  ~CLABMA08.2da~ ~override~ //illusionist
			  ~CLABMA09.2da~ ~override~ //enchanter	
	INSERT_2DA_ROW 3 0 ~ARCNCRFT GA_B_SCRIB	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
 
COPY_EXISTING ~CLABMA01.2da~ ~override~ //mage/sorcerer
	INSERT_2DA_ROW 3 0 ~ARCNCRFT AP_QDSCRCK	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 

COPY_EXISTING ~QDDDBLA.2da~ ~override~ //dragon disciple wands crafting
			  ~QDDDBLU.2da~ ~override~ 
			  ~QDDDGRE.2da~ ~override~ 
			  ~QDDDRED.2da~ ~override~ 
			  ~QDDDWHI.2da~ ~override~ 
			  ~QDDDBRA.2da~ ~override~ 
			  ~QDDDBRO.2da~ ~override~ 
			  ~QDDDCOP.2da~ ~override~ 
			  ~QDDDGOL.2da~ ~override~ 
			  ~QDDDSIL.2da~ ~override~ 
				INSERT_2DA_ROW 3 0 ~ARCNCRFT ****	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
				 

// -----------------------------
// SORCERER BLOODLINES KITPACK 
// -----------------------------
BEGIN @101
GROUP ~New Kits~ 
DESIGNATED 6
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb06.qd~ //detection for this component 

// -----------------------------
// NEW KIT: CELESTIAL SORCERER 
// -----------------------------
ADD_KIT ~QDCELSOR~
	~QDCELSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDCELSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDCELSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDCELSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDCELSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDCELSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDCELSOR 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDCELSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/celestial/QDCELSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @102
	SAY @103
	SAY @104

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@104)
		STR_VAR
			kit_name = QDCELSOR
	END
END			

COPY ~TomeAndBlood/data/bloodline/celestial/QDCEL02.SPL~ ~override~ //permanent protection from evil 
	 ~TomeAndBlood/data/bloodline/celestial/QDCEL03.SPL~ ~override~ //+5% acid/cold res
	 ~TomeAndBlood/data/bloodline/celestial/QDCEL04.SPL~ ~override~ //+10% acid/cold res
	 ~TomeAndBlood/data/bloodline/celestial/QDCEL05.SPL~ ~override~ //imm poison and disease

ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
	COPY ~TomeAndBlood/data/bloodline/celestial/QDCEL01_BG.SPL~ ~override/QDCEL01.SPL~ //bloodline
END	ELSE
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
	COPY ~TomeAndBlood/data/bloodline/celestial/QDCEL01_IWD.SPL~ ~override/QDCEL01.SPL~ //bloodline
END	

// -----------------------------
// NEW KIT: FIENDISH SORCERER 
// -----------------------------		

ADD_KIT ~QDFIESOR~
	~QDFIESOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDFIESOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDFIESOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDFIESOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDFIESOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDFIESOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDFIESOR 0 0 1 0 0 1 0 0 1~ //alignmnt.2da
	~QDFIESOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/fiendish/QDFIESOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @131
	SAY @132
	SAY @133

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@133)
		STR_VAR
			kit_name = QDFIESOR
	END
END	

COPY ~TomeAndBlood/data/bloodline/fiendish/QDFIE01.SPL~ ~override~ //bloodline spells
	 ~TomeAndBlood/data/bloodline/fiendish/QDFIE02.SPL~ ~override~ //+1 to hit and damage
	 ~TomeAndBlood/data/bloodline/fiendish/QDFIE03.SPL~ ~override~ //+5% elec/fire res
	 ~TomeAndBlood/data/bloodline/fiendish/QDFIE04.SPL~ ~override~ //+10% elec/fire res
	 ~TomeAndBlood/data/bloodline/fiendish/QDFIE05.SPL~ ~override~ //imm backstabs and blind
	 
// -----------------------------
// NEW KIT: STORMBORN SORCERER 
// -----------------------------		

ADD_KIT ~QDSTOSOR~
	~QDSTOSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDSTOSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDSTOSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDSTOSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDSTOSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDSTOSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDSTOSOR 0 0 0 1 1 1 1 1 1~ //alignmnt.2da
	~QDSTOSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/stormborn/QDSTOSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @151
	SAY @152
	SAY @153

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@153)
		STR_VAR
			kit_name = QDSTOSOR
	END
END		
	
COPY ~TomeAndBlood/data/bloodline/stormborn/QDSTO02.SPL~ ~override~ //+1 to AC and movement
	 ~TomeAndBlood/data/bloodline/stormborn/QDSTO03.SPL~ ~override~ //+10% elec res
	 ~TomeAndBlood/data/bloodline/stormborn/QDSTO04.SPL~ ~override~ //+15% elec res 
	 ~TomeAndBlood/data/bloodline/stormborn/QDSTO05.SPL~ ~override~ //+25% elec res 

ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
	COPY ~TomeAndBlood/data/bloodline/stormborn/QDSTO01_BG.SPL~ ~override/QDSTO01.SPL~ //bloodline
END	ELSE
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN
	COPY ~TomeAndBlood/data/bloodline/stormborn/QDSTO01_IWD.SPL~ ~override/QDSTO01.SPL~ //bloodline
END	
	
// -----------------------------
// NEW KIT: RIMEBLOODED SORCERER 
// -----------------------------		

ADD_KIT ~QDRBLSOR~
	~QDRBLSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDRBLSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDRBLSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDRBLSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDRBLSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDRBLSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDRBLSOR 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDRBLSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/rimeblooded/QDRBLSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @171
	SAY @172
	SAY @173
	
ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@173)
		STR_VAR
			kit_name = QDRBLSOR
	END
END	
	
COPY ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL01.SPL~ ~override~ //bloodline spells
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL02.SPL~ ~override~ //+10% cold res
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL03.SPL~ ~override~ //+15% elec res
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL04.SPL~ ~override~ //+25% elec res 
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL05.SPL~ ~override~ //level 1 imbue frost
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL06.SPL~ ~override~ //level 5 imbue frost
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL07.SPL~ ~override~ //level 10 imbue frost
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL05A.EFF~ ~override~ //level 1 imbue frost eff
	 ~TomeAndBlood/data/bloodline/rimeblooded/QDRBL07A.EFF~ ~override~ //level 10 imbue frost eff
	 
	 
// -----------------------------
// NEW KIT: GROVEBORN SORCERER 
// -----------------------------		

ADD_KIT ~QDGROSOR~
	~QDGROSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDGROSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDGROSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDGROSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDGROSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDGROSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDGROSOR 0 1 0 1 1 1 0 1 0~ //alignmnt.2da
	~QDGROSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/groveborn/QDGROSOR.2da~ //CLAB
	~~  
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @201
	SAY @202
	SAY @203

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@203)
		STR_VAR
			kit_name = QDGROSOR
	END
END	

COPY ~TomeAndBlood/data/bloodline/groveborn/QDGRO01.SPL~ ~override~ //bloodline spells
	 ~TomeAndBlood/data/core/QDABJ01.SPL~ ~override/QDGRO02.SPL~ //+1 AC
	 ~TomeAndBlood/data/bloodline/groveborn/QDGRO03.SPL~ ~override~ //+1 to saves vs death and spells
	 ~TomeAndBlood/data/bloodline/celestial/QDCEL05.SPL~ ~override/QDGRO04.SPL~ //imm disease and poison

	 
// -----------------------------
// NEW KIT: SYLVAN SORCERER 
// -----------------------------		

ADD_KIT ~QDSYLSOR~
	~QDSYLSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDSYLSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDSYLSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDSYLSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDSYLSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDSYLSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDSYLSOR 0 0 0 1 1 1 1 1 1~ //alignmnt.2da
	~QDSYLSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/sylvan/QDSYLSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @231
	SAY @232
	SAY @233

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@233)
		STR_VAR
			kit_name = QDSYLSOR
	END
END		

COPY ~TomeAndBlood/data/bloodline/sylvan/QDSYL01.SPL~ ~override~ //bloodline spells
     ~TomeAndBlood/data/bloodline/sylvan/QDSYL02.SPL~ ~override~ //+1 save vs spell
     ~TomeAndBlood/data/bloodline/sylvan/QDSYL03.SPL~ ~override~ //+5% magic resistance
     ~TomeAndBlood/data/bloodline/sylvan/QDSYL04.SPL~ ~override~ //+10% magic resistance
     ~TomeAndBlood/data/bloodline/sylvan/QDSYL05.SPL~ ~override~ //imm sleep

// -----------------------------
// NEW KIT: REVENANT SORCERER 
// -----------------------------		

ADD_KIT ~QDREVSOR~
	~QDREVSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDREVSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDREVSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDREVSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDREVSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDREVSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDREVSOR 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDREVSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/revenant/QDREVSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @251
	SAY @252
	SAY @253


ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@253)
		STR_VAR
			kit_name = QDREVSOR
			hpclass = HPDD
	END
END		

COPY ~TomeAndBlood/data/bloodline/revenant/QDREV01.SPL~ ~override~ //bloodline spells
	 ~TomeAndBlood/data/bloodline/revenant/QDREV02.SPL~ ~override~ //+1 saves vs death
	 ~TomeAndBlood/data/bloodline/revenant/QDREV03.SPL~ ~override~ //imm sleep
	 ~TomeAndBlood/data/bloodline/revenant/QDREV04.SPL~ ~override~ //imm normal weapons
	 ~TomeAndBlood/data/bloodline/revenant/QDREV05.SPL~ ~override~ //imm death magic
	 ~TomeAndBlood/data/bloodline/revenant/QDREV06.SPL~ ~override~ //+5% phys res
	 ~TomeAndBlood/data/bloodline/revenant/QDREV07.SPL~ ~override~ //+10% phys res 
	 
// -----------------------------
// NEW KIT: AMORPHOUS SORCERER 
// -----------------------------		

ADD_KIT ~QDOOZSOR~
	~QDOOZSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDOOZSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDOOZSOR 0 0 0 0 0 9~ //abclasrq.2da 
	~QDOOZSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDOOZSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDOOZSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDOOZSOR 0 0 0 1 1 1 1 1 1~ //alignmnt.2da
	~QDOOZSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/amorphous/QDOOZSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @261
	SAY @262
	SAY @263

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@263)
		STR_VAR
			kit_name = QDOOZSOR
	END
END	

COPY ~TomeAndBlood/data/bloodline/amorphous/QDOOZ01.SPL~ ~override~ //bloodline spells
     ~TomeAndBlood/data/bloodline/celestial/QDCEL05.SPL~ ~override/QDOOZ02.SPL~ //+1 save vs spell
     ~TomeAndBlood/data/bloodline/amorphous/QDOOZ03.SPL~ ~override~ //+10% acid resistance
     ~TomeAndBlood/data/bloodline/amorphous/QDOOZ04.SPL~ ~override~ //+15% acid resistance
     ~TomeAndBlood/data/bloodline/amorphous/QDOOZ05.SPL~ ~override~ //+25% acid resistance
     ~TomeAndBlood/data/bloodline/amorphous/QDOOZ06.SPL~ ~override~ //+10% crush/missile/pierce res
	 
// -----------------------------
// ELDRITCH SORCERER
// -----------------------------
	 
ADD_KIT ~QDELDSOR~
	~QDELDSOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDELDSOR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDELDSOR 0 12 12 0 0 9~ //abclasrq.2da 
	~QDELDSOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDELDSOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDELDSOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDELDSOR 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDELDSOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/bloodline/QDELDSOR.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @6
	SAY @7
	SAY @8

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@8)
		STR_VAR
			kit_name = QDELDSOR
	END
END	

// -----------------------------
// DECLARING A BLOODLINE 
// -----------------------------
COMPILE ~TomeAndBlood/data/bloodline/QDSORBLD.BAF~ 
COMPILE ~TomeAndBlood/data/bloodline/QDSORBLD.D~ 

COPY ~TomeAndBlood/data/bloodline/QDSORBLD.CRE~ ~override~ //bloodline declaration creature 

COPY ~TomeAndBlood/data/bloodline/QDSORBL.SPL~ ~override~ //sorcerer innate: declare bloodline
	SAY NAME1 @302
	SAY UNIDENTIFIED_DESC @303
	
COPY ~TomeAndBlood/data/bloodline/QDSBLDA.SPL~ ~override~ //sorcerer check: bloodline
	 ~TomeAndBlood/data/bloodline/QDSBLDA.EFF~ ~override~ //sorcerer check effect: bloodline 
	 ~TomeAndBlood/data/bloodline/QDFMLRA.SPL~ ~override~ //mage check: familiar
	 ~TomeAndBlood/data/bloodline/QDFMLRA.EFF~ ~override~ //mage check effect: familiar

COPY ~TomeAndBlood/data/bloodline/CLABMA01.2DA~ ~override~ //new mage/sor clab
	  
ACTION_IF GAME_IS ~bgee~ THEN BEGIN 
	STRING_SET ~24233~ @440 //new sorcerer description 
	STRING_SET ~32300~ @440 //new sorcerer description 
END

	  
ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
	STRING_SET ~45866~ @440 //new sorcerer description 
END
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	STRING_SET ~34605~ @440 //new sorcerer description 
	STRING_SET ~37249~ @440 //new sorcerer description 
END

ACTION_IF FILE_EXISTS_IN_GAME ~qdtnb03.qd~ THEN BEGIN //check for armored casting
	ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN 
		STRING_SET ~24233~ @802 //new sorcerer description 
		STRING_SET ~32300~ @802 //new sorcerer description 
	END

	ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
		STRING_SET ~34605~ @802 //new sorcerer description 
		STRING_SET ~37249~ @802 //new sorcerer description 
	END
END

COPY_EXISTING_REGEXP GLOB ~^.+\.cre$~ ~override~ //updating npc kits
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_BYTE 0x273 "class" ELSE 0
    PATCH_IF ("%class%" = 19) BEGIN
        WRITE_SHORT 0x246 ("QDELDSOR" + 0x4000)
	END	
END
BUT_ONLY 

// -----------------------------
// SPELL SELECT UPDATES
// -----------------------------
ACTION_IF FILE_EXISTS_IN_GAME ~qdtnb01.qd~ THEN BEGIN //check for spell select component	
	COPY_EXISTING ~QDELDSOR.2da~ ~override~ 
			      ~QDCELSOR.2da~ ~override~ 
			      ~QDFIESOR.2da~ ~override~ 
			      ~QDSTOSOR.2da~ ~override~ 
			      ~QDRBLSOR.2da~ ~override~ 
			      ~QDGROSOR.2da~ ~override~ 
			      ~QDSYLSOR.2da~ ~override~ 
			      ~QDREVSOR.2da~ ~override~ 
			      ~QDOOZSOR.2da~ ~override~ 
 
						INSERT_2DA_ROW 3 0 ~MEMORIZE GA_QDSORSM ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END 

// -----------------------------
// ARMORED CASTING UPDATES
// -----------------------------

ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb03.qd~) THEN BEGIN //check for armored casting component	
	COPY_EXISTING ~QDELDSOR.2da~ ~override~ //eldritch
			      ~QDCELSOR.2da~ ~override~ //celestial
			      ~QDFIESOR.2da~ ~override~ //fiendish
			      ~QDSTOSOR.2da~ ~override~ //stormborn
			      ~QDRBLSOR.2da~ ~override~ //rimeblooded
			      ~QDGROSOR.2da~ ~override~ //groveborn
			      ~QDSYLSOR.2da~ ~override~ //sylvan
			      ~QDREVSOR.2da~ ~override~ //revenant
			      ~QDOOZSOR.2da~ ~override~ //amorphous
			      ~CLABMA01.2da~ ~override~ //base mage and sorcerer
 
						INSERT_2DA_ROW 3 0 ~ARMRCAST AP_QDACNO ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END 

//ARCANE CRAFTING UPDATES
ACTION_IF FILE_EXISTS_IN_GAME ~qdtnb05.qd~ THEN BEGIN //bloodline wands crafting	
	COPY_EXISTING ~QDELDSOR.2da~ ~override~ 
			      ~QDCELSOR.2da~ ~override~ 
			      ~QDFIESOR.2da~ ~override~ 
			      ~QDSTOSOR.2da~ ~override~ 
			      ~QDRBLSOR.2da~ ~override~ 
			      ~QDGROSOR.2da~ ~override~ 
			      ~QDSYLSOR.2da~ ~override~ 
			      ~QDREVSOR.2da~ ~override~ 
			      ~QDOOZSOR.2da~ ~override~ 
 
						INSERT_2DA_ROW 3 0 ~ARCNCRFT ****	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END 

//-----------------------------
// COMPATIBILITY WITH MORE STYLE FOR WIZARDS by PECCA 
//-----------------------------

ACTION_IF FILE_EXISTS_IN_GAME ~WSSPELLS.SPL~ THEN BEGIN  //checking for MSFM 
	COMPILE ~TomeAndBlood/data/compatibility/QD_MSFM_fix_6.D~ 	 	 
END 

// -----------------------------
// ORACLE AND SUBKITS
// -----------------------------		
BEGIN @600
GROUP ~New Kits~ 
DESIGNATED 7
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~1~ @601 //requires Spell Select through Dialogue
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~3~ @602 //requires Armored Casting
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~4~ @603 //requires Universal Weapons
REQUIRE_PREDICATE (GAME_IS ~bg2ee iwdee~) @501			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb07.qd~ //detection for this component

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

//oracle base class
ADD_KIT ~QDORATOP~
	~QDORATOP 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORATOP 0 1 0 1 1 1 0 1 0 0 0 0 0 0 0 1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORATOP 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORATOP 0 0 0 0 0 0~ //abclsmod.2da
	~QDORATOP 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORATOP 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORATOP 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDORATOP 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORATOP.2da~ //CLAB
	~K_S_H K_S_E K_S_G K_S_HE~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @604
	SAY @605
	SAY @606

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@606)
		STR_VAR
			kit_name = QDORATOP
			hpclass = HPROG
	END
END	

//oracle of battle subkit
ADD_KIT ~QDORABAT~
	~QDORABAT 2 2 1 2 2 2 2 1~ //clasweap.2da
	~QDORABAT 2 2 1 2 2 2 2 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 	  	
	~QDORABAT 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORABAT 0 0 0 0 0 0~ //abclsmod.2da
	~QDORABAT 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORABAT 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORABAT 0 0 0 0 0 0 1 1 1~ //alignmnt.2da
	~QDORABAT 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORABAT.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @610
	SAY @611
	SAY @612

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@612)
		STR_VAR
			kit_name = QDORABAT
			hpclass = HPPRS
			clswpbon = ~1 0 3~
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORBA1.SPL~ ~override~ //bonus spell: stoneskin 
	 ~TomeAndBlood/data/oracle/QDORBA2.SPL~ ~override~ //bonus spell: blade barrier 

//oracle of flame subkit
ADD_KIT ~QDORAFLA~
	~QDORAFLA 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORAFLA 0 1 0 1 1 1 0 1 0 0 0 0 0 0 0 1 1 1 1 0 2 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORAFLA 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORAFLA 0 0 0 0 0 0~ //abclsmod.2da
	~QDORAFLA 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORAFLA 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORAFLA 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDORAFLA 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORAFLA.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @613
	SAY @614
	SAY @615

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@615)
		STR_VAR
			kit_name = QDORAFLA
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORFL1.SPL~ ~override~ //bonus spell: burning hands
	 ~TomeAndBlood/data/oracle/QDORFL2.SPL~ ~override~ //bonus spell: fireball
	 ~TomeAndBlood/data/oracle/QDORFL3.SPL~ ~override~ //Cinder Dance: +2 movement, imm: Web, Entangle
	 ~TomeAndBlood/data/oracle/QDORFL4.SPL~ ~override~ //+10% fire resistance
	 ~TomeAndBlood/data/oracle/QDORFL5.SPL~ ~override~ //+15% fire resistance
	 ~TomeAndBlood/data/oracle/QDORFL6.SPL~ ~override~ //+25% fire resistance
	 
	 
//oracle of life subkit
ADD_KIT ~QDORALIF~
	~QDORALIF 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORALIF 0 1 0 1 1 1 0 1 0 0 0 0 0 0 2 1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORALIF 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORALIF 0 0 0 0 0 0~ //abclsmod.2da
	~QDORALIF 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORALIF 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORALIF 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDORALIF 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORALIF.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @616
	SAY @617
	SAY @618

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@618)
		STR_VAR
			kit_name = QDORALIF
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORLI1.SPL~ ~override~ //bonus spell: cure light wounds 
	 ~TomeAndBlood/data/oracle/QDORLI2.SPL~ ~override~ //bonus spell: cure medium wounds
	 ~TomeAndBlood/data/oracle/QDORLI3.SPL~ ~override~ //bonus spell: raise dead
	 ~TomeAndBlood/data/oracle/QDORLI4.SPL~ ~override~ //imm: level drain, poison, disease
	
//oracle of lore subkit
ADD_KIT ~QDORALOR~
	~QDORALOR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORALOR 0 1 0 1 1 1 0 1 0 2 0 0 0 0 0 1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORALOR 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORALOR 0 0 0 0 0 0~ //abclsmod.2da
	~QDORALOR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORALOR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORALOR 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDORALOR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORALOR.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @616
	SAY @617
	SAY @618

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@618)
		STR_VAR
			kit_name = QDORALOR
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORLO1.SPL~ ~override~ //bonus spell: identify
	 ~TomeAndBlood/data/oracle/QDORLO2.SPL~ ~override~ //bonus spell: limited wish
	 ~TomeAndBlood/data/oracle/QDORLO3.SPL~ ~override~ //bonus spell: +2 casting speed 

//oracle of nature subkit
ADD_KIT ~QDORANAT~
	~QDORANAT 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORANAT 0 1 0 1 1 1 0 1 0 0 0 0 0 0 0 1 2 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORANAT 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORANAT 0 0 0 0 0 0~ //abclsmod.2da
	~QDORANAT 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORANAT 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORANAT 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDORANAT 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORANAT.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @622
	SAY @623
	SAY @624

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@624)
		STR_VAR
			kit_name = QDORANAT
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORNA1.SPL~ ~override~ //bonus spell: entangle
	 ~TomeAndBlood/data/oracle/QDORNA2.SPL~ ~override~ //bonus spell: barkskin
	 ~TomeAndBlood/data/oracle/QDORNA3.SPL~ ~override~ //bonus damage against constructs & undead
	 ~TomeAndBlood/data/oracle/QDORNA3.EFF~ ~override~ //cast spell EFF 
	 ~TomeAndBlood/data/oracle/QDORNAA.SPL~ ~override~ //check for undead/construct
	 ~TomeAndBlood/data/oracle/QDORNAA.EFF~ ~override~ //bonus damage EFF
	 ~TomeAndBlood/data/oracle/QDORNA4.SPL~ ~override~ //+2 AC, immunity to Silence, Poison, Disease
	 
//oracle of winter subkit
ADD_KIT ~QDORAWIN~
	~QDORAWIN 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORAWIN 0 1 0 1 1 1 0 1 0 0 0 2 0 0 0 1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORAWIN 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORAWIN 0 0 0 0 0 0~ //abclsmod.2da
	~QDORAWIN 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORAWIN 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORAWIN 1 0 0 1 0 0 1 0 0~ //alignmnt.2da
	~QDORAWIN 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORAWIN.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @625
	SAY @626
	SAY @627

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@627)
		STR_VAR
			kit_name = QDORAWIN
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORWI1.SPL~ ~override~ //bonus spell: chill touch
	 ~TomeAndBlood/data/oracle/QDORWI2.SPL~ ~override~ //bonus spell: ice storm
	 ~TomeAndBlood/data/oracle/QDORWI3.SPL~ ~override~ //bonus spell: cone of cold
	 ~TomeAndBlood/data/oracle/QDORWI4.SPL~ ~override~ //bonus cold damage on melee hit  
	 ~TomeAndBlood/data/oracle/QDORWI4.EFF~ ~override~ //bonus cold damage on melee hit  
	 ~TomeAndBlood/data/oracle/QDORWI5.SPL~ ~override~ //+10% cold res 
	 ~TomeAndBlood/data/oracle/QDORWI6.SPL~ ~override~ //+15% cold res 
	 ~TomeAndBlood/data/oracle/QDORWI7.SPL~ ~override~ //+25% cold res 


//oracle of murder subkit
ADD_KIT ~QDORAMUR~
	~QDORAMUR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORAMUR 0 1 0 1 1 1 0 1 0 0 0 0 0 0 0 2 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORAMUR 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORAMUR 0 0 0 0 0 0~ //abclsmod.2da
	~QDORAMUR 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORAMUR 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORAMUR 0 0 1 0 0 1 1 1 1~ //alignmnt.2da
	~QDORAMUR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORAMUR.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @3000
	SAY @3001
	SAY @3002

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@3002)
		STR_VAR
			kit_name = QDORAMUR
			hpclass = HPROG
			backstab = ~1             2             2             2             2             2             2             2             2             3             3             3             3             3             3             3             3             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4             4~ 
	END
END 

COPY ~TomeAndBlood/data/oracle/QDORMU1.SPL~ ~override~ //bonus spells, +2 saves vs. death, imm to poison, imm to backstab

COPY ~TomeAndBlood/data/oracle/QDORMU2.SPL~ ~override~ //poison weapon 
	SAY NAME1 @3003
	SAY UNIDENTIFIED_DESC @3004


//oracle of eyes subkit
ADD_KIT ~QDORAEYE~
	~QDORAEYE 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDORAEYE 0 1 0 1 1 1 0 1 0 0 0 0 0 0 0 1 1 1 1 0 1 1 1 1 0 1 1 2 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDORAEYE 0 0 0 0 0 12~ //abclasrq.2da 
	~QDORAEYE 0 0 0 0 0 0~ //abclsmod.2da
	~QDORAEYE 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDORAEYE 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDORAEYE 0 0 1 0 0 1 0 0 0~ //alignmnt.2da
	~QDORAEYE 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/oracle/QDORAEYE.2da~ //CLAB
	~~ 
	~0x00004100	19~ 
	~MA0~ //needs a proper HLA table (mage's and priest's are both useless) 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @3010
	SAY @3011
	SAY @3012

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@3012)
		STR_VAR
			kit_name = QDORAEYE
			hpclass = HPROG
	END
END 

COPY ~TomeAndBlood/data/oracle/QDOREY1.SPL~ ~override~ //bonus spells, imm blind, can't use helmets

ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN
	COPY ~TomeAndBlood/data/oracle/QDPR220.SPL~ ~override~ //cause moderate wounds
		SAY NAME1 @3013
		SAY UNIDENTIFIED_DESC @3014
END	

	
//oracle spells dialogue/scripts 
ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN 
	COMPILE ~TomeAndBlood/data/oracle/bg2/QDSPLORA.BAF~ 
	COMPILE ~TomeAndBlood/data/oracle/bg2/QDSPLORA.D~ 
END

ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	COMPILE ~TomeAndBlood/data/oracle/iwd/QDSPLORA.BAF~ 
	COMPILE ~TomeAndBlood/data/oracle/iwd/QDSPLORA.D~ 
END

COPY ~TomeAndBlood/data/oracle/QDORASP.CRE~ ~override~ //oracle spell creature

COPY ~TomeAndBlood/data/oracle/QDORASP.SPL~ ~override~ //oracle innate: spell knowledge
	SAY NAME1 @300
	SAY UNIDENTIFIED_DESC @301

	
//oracle mystery declaration
COPY ~TomeAndBlood/data/oracle/QDORAMYS.CRE~ ~override~ //mystery declaration creature 

COPY ~TomeAndBlood/data/oracle/QDORMYS!.SPL~ ~override~ //mystery declaration removal

COPY ~TomeAndBlood/data/oracle/QDORAMY.SPL~ ~override~ //oracle innate: declare mystery
	SAY NAME1 @607
	SAY UNIDENTIFIED_DESC @608
	
COMPILE ~TomeAndBlood/data/oracle/QDORAMYS.BAF~ 
COMPILE ~TomeAndBlood/data/oracle/QDORAMYS.D~ 

//oracle specialty Cure spells 
COPY ~TomeAndBlood/data/oracle/QDOR103.SPL~ ~override~ //oracle: cure light wounds
	SAY NAME1 @630
	SAY UNIDENTIFIED_DESC @631

COPY ~TomeAndBlood/data/oracle/QDOR217.SPL~ ~override~ //oracle: cure moderate wounds
	SAY NAME1 @632
	SAY UNIDENTIFIED_DESC @633
	
COPY ~TomeAndBlood/data/oracle/QDOR315.SPL~ ~override~ //oracle: cure medium wounds
	SAY NAME1 @634
	SAY UNIDENTIFIED_DESC @635
	
COPY ~TomeAndBlood/data/oracle/QDOR401.SPL~ ~override~ //oracle: cure serious wounds
	SAY NAME1 @636
	SAY UNIDENTIFIED_DESC @637
	
COPY ~TomeAndBlood/data/oracle/QDOR502.SPL~ ~override~ //oracle: cure critical wounds
	SAY NAME1 @638
	SAY UNIDENTIFIED_DESC @639
	
COPY ~TomeAndBlood/data/oracle/QDOR514.SPL~ ~override~ //oracle: mass cure light wounds
	SAY NAME1 @640
	SAY UNIDENTIFIED_DESC @641

//Animations, courtesy of Grammarsalad and Dib and used with permission
	COPY ~TomeAndBlood/data/anims/B_ANIFS.spl~ ~override~ //Animation spl
		 ~TomeAndBlood/data/anims/B_AFSFH.eff~ ~override~ //Female Human
		 ~TomeAndBlood/data/anims/B_FSFH.eff~ ~override~ //Female Human
		 ~TomeAndBlood/data/anims/B_AFSFE.eff~ ~override~ //Female Elf
		 ~TomeAndBlood/data/anims/B_FSFE.eff~ ~override~ //Female Elf
		 ~TomeAndBlood/data/anims/B_AFSFHE.eff~ ~override~ //Female hElf--ani as elf
		 ~TomeAndBlood/data/anims/B_AFSFD.eff~ ~override~ //Female Dwarf
		 ~TomeAndBlood/data/anims/B_FSFD.eff~ ~override~ //Female Dwarf
		 ~TomeAndBlood/data/anims/B_AFSFHA.eff~ ~override~ //Female Half
		 ~TomeAndBlood/data/anims/B_FSFHA.eff~ ~override~ //Female Half
		 ~TomeAndBlood/data/anims/B_AFSFG.eff~ ~override~ //Female Gnome
		 ~TomeAndBlood/data/anims/B_FSFG.eff~ ~override~ //Female Gnome
		 ~TomeAndBlood/data/anims/B_AFSFHO.eff~ ~override~ //Female Halforc
		 ~TomeAndBlood/data/anims/B_FSFHO.eff~ ~override~ //Female Halforc
		 ~TomeAndBlood/data/anims/B_AFSMH.eff~ ~override~ //Male Human
		 ~TomeAndBlood/data/anims/B_FSMH.eff~ ~override~ //Male Human
		 ~TomeAndBlood/data/anims/B_AFSME.eff~ ~override~ //male Elf
		 ~TomeAndBlood/data/anims/B_FSME.eff~ ~override~ //male Elf
		 ~TomeAndBlood/data/anims/B_AFSMHE.eff~ ~override~ //male hElf--ani as elf
		 ~TomeAndBlood/data/anims/B_AFSMD.eff~ ~override~ //male Dwarf
		 ~TomeAndBlood/data/anims/B_FSMD.eff~ ~override~ //male Dwarf
		 ~TomeAndBlood/data/anims/B_AFSMHA.eff~ ~override~ //male Half
		 ~TomeAndBlood/data/anims/B_FSMHA.eff~ ~override~ //male Half
		 ~TomeAndBlood/data/anims/B_AFSMG.eff~ ~override~ //male Gnome
		 ~TomeAndBlood/data/anims/B_FSMG.eff~ ~override~ //male Gnome
		 ~TomeAndBlood/data/anims/B_AFSMHO.eff~ ~override~ //male Halforc
		 ~TomeAndBlood/data/anims/B_FSMHO.eff~ ~override~ //male Halforc
		 ~TomeAndBlood/data/anims/D#FAVANI.BCS~ ~override~ //appearance script
		 ~TomeAndBlood/data/anims/D#FAVANI.SPL~ ~override~ //appearance spell
		 
		

// -----------------------------
// MAGUS
// -----------------------------		
BEGIN @750
GROUP ~New Kits~ 
DESIGNATED 8
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~3~ @602 //requires Armored Casting
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~4~ @603 //requires Universal Weapons
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb08.qd~ //detection for this component

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

//magus class
ADD_KIT ~QDMAGUS~
	~QDMAGUS 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMAGUS 2 2 1 2 2 2 2 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 2 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 	  	
	~QDMAGUS 12 0 0 0 0 12~ //abclasrq.2da 
	~QDMAGUS 0 0 0 0 0 0~ //abclsmod.2da
	~QDMAGUS 17 0 0 0 0 17~ //abdcdsrq.2da
	~QDMAGUS 15 0 0 0 0 15~ //abdcscrq.2da 
	~QDMAGUS 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMAGUS 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/magus/QDMAGUS.2da~ //CLAB
	~K_S_H K_S_E K_S_HE~ 
	~0x00004000	19~ 
	~FM0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @751
	SAY @752
	SAY @753

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@753)
		STR_VAR
			kit_name = QDMAGUS
			hpclass = HPPRS
	END
END	

COPY ~TomeAndBlood/data/magus/QDMGUS1.SPL~ ~override~ //magus: can't use shields

ACTION_IF FILE_EXISTS_IN_GAME ~qdtnb01.qd~ THEN BEGIN //check for spell select component	
	COPY_EXISTING ~QDMAGUS.2da~ ~override~ 
		INSERT_2DA_ROW 3 0 ~MEMORIZE GA_QDSORSM ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END 

ACTION_IF (NOT FILE_EXISTS_IN_GAME ~qdtnb07.qd~) THEN BEGIN //check for oracles	
	//Animations, courtesy of Grammarsalad and Dib and used with permission
	COPY ~TomeAndBlood/data/anims/B_ANIFS.spl~ ~override~ //Animation spl
		 ~TomeAndBlood/data/anims/B_AFSFH.eff~ ~override~ //Female Human
		 ~TomeAndBlood/data/anims/B_FSFH.eff~ ~override~ //Female Human
		 ~TomeAndBlood/data/anims/B_AFSFE.eff~ ~override~ //Female Elf
		 ~TomeAndBlood/data/anims/B_FSFE.eff~ ~override~ //Female Elf
		 ~TomeAndBlood/data/anims/B_AFSFHE.eff~ ~override~ //Female hElf--ani as elf
		 ~TomeAndBlood/data/anims/B_AFSFD.eff~ ~override~ //Female Dwarf
		 ~TomeAndBlood/data/anims/B_FSFD.eff~ ~override~ //Female Dwarf
		 ~TomeAndBlood/data/anims/B_AFSFHA.eff~ ~override~ //Female Half
		 ~TomeAndBlood/data/anims/B_FSFHA.eff~ ~override~ //Female Half
		 ~TomeAndBlood/data/anims/B_AFSFG.eff~ ~override~ //Female Gnome
		 ~TomeAndBlood/data/anims/B_FSFG.eff~ ~override~ //Female Gnome
		 ~TomeAndBlood/data/anims/B_AFSFHO.eff~ ~override~ //Female Halforc
		 ~TomeAndBlood/data/anims/B_FSFHO.eff~ ~override~ //Female Halforc
		 ~TomeAndBlood/data/anims/B_AFSMH.eff~ ~override~ //Male Human
		 ~TomeAndBlood/data/anims/B_FSMH.eff~ ~override~ //Male Human
		 ~TomeAndBlood/data/anims/B_AFSME.eff~ ~override~ //male Elf
		 ~TomeAndBlood/data/anims/B_FSME.eff~ ~override~ //male Elf
		 ~TomeAndBlood/data/anims/B_AFSMHE.eff~ ~override~ //male hElf--ani as elf
		 ~TomeAndBlood/data/anims/B_AFSMD.eff~ ~override~ //male Dwarf
		 ~TomeAndBlood/data/anims/B_FSMD.eff~ ~override~ //male Dwarf
		 ~TomeAndBlood/data/anims/B_AFSMHA.eff~ ~override~ //male Half
		 ~TomeAndBlood/data/anims/B_FSMHA.eff~ ~override~ //male Half
		 ~TomeAndBlood/data/anims/B_AFSMG.eff~ ~override~ //male Gnome
		 ~TomeAndBlood/data/anims/B_FSMG.eff~ ~override~ //male Gnome
		 ~TomeAndBlood/data/anims/B_AFSMHO.eff~ ~override~ //male Halforc
		 ~TomeAndBlood/data/anims/B_FSMHO.eff~ ~override~ //male Halforc
		 ~TomeAndBlood/data/anims/D#FAVANI.BCS~ ~override~ //appearance script
		 ~TomeAndBlood/data/anims/D#FAVANI.SPL~ ~override~ //appearance spell
END

ACTION_IF FILE_EXISTS_IN_GAME ~qdtnb05.qd~ THEN BEGIN //check for arcane crafting	
	COPY_EXISTING ~QDMAGUS.2da~ ~override~ 
		INSERT_2DA_ROW 3 0 ~ARCNCRFT ****	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 
END 

// -----------------------------
// SPECIALIST MAGES KITPACK 
// -----------------------------		
BEGIN @1099
GROUP ~New Kits~ 
DESIGNATED 9
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee iwdee~) @502			

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb09.qd~ //detection for this component

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

//removing old kit abilities from the core component

COPY_EXISTING ~CLABMA02.2da~ ~override~ //abjurer
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDABJ01~ ~****      ~
	
COPY_EXISTING ~CLABMA04.2da~ ~override~ //transmuter
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDALT01~ ~****      ~

COPY_EXISTING ~CLABMA05.2da~ ~override~ //diviner
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDMLORE~ ~****      ~

COPY_EXISTING ~CLABMA06.2da~ ~override~ //conjurer
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~GA_QDFAMLR~ ~****      ~
	
COPY_EXISTING ~CLABMA07.2da~ ~override~ //invoker
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDINV01~ ~****      ~

COPY_EXISTING ~CLABMA08.2da~ ~override~ //illusionist
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDILL01~ ~****      ~

COPY_EXISTING ~CLABMA09.2da~ ~override~ //enchanter
	REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~AP_QDENC01~ ~****      ~
	
COPY_EXISTING ~CLABMA02.2da~ ~override~ //abjurer
			  ~CLABMA03.2da~ ~override~ //necromancer
			  ~CLABMA04.2da~ ~override~ //transmuter
			  ~CLABMA05.2da~ ~override~ //diviner
			  ~CLABMA06.2da~ ~override~ //conjurer
			  ~CLABMA07.2da~ ~override~ //invoker
			  ~CLABMA08.2da~ ~override~ //illusionist
			  ~CLABMA09.2da~ ~override~ //enchanter	
	INSERT_2DA_ROW 3 0 ~DECLARE GA_QDMGKIT	 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 

COPY_EXISTING HPCLASS.2da override //changes to necromancer hp
  COUNT_2DA_COLS cols
  SET_2DA_ENTRY_LATER hpclass 25 1  ~HPWIZ~ // changing conjurer hitdie back to D4
  SET_2DA_ENTRY_LATER hpclass 30 1  ~HPWIZ~ // changing necromancer hitdie back to D4
  SET_2DA_ENTRIES_NOW hpclass cols
  PRETTY_PRINT_2DA
BUT_ONLY	
	
ACTION_IF GAME_IS ~bgee bg2ee~ THEN BEGIN 
	STRING_SET ~9564~ @1310 //new abjurer description
	STRING_SET ~24290~ @1310 //new abjurer description
	STRING_SET ~9565~ @1311 //new conjurer description
	STRING_SET ~24291~ @1311 //new conjurer description
	STRING_SET ~9566~ @1312 //new diviner description
	STRING_SET ~24292~ @1312 //new diviner description
	STRING_SET ~9567~ @1313 //new enchanter description
	STRING_SET ~24293~ @1313 //new enchanter description
	STRING_SET ~9568~ @1314 //new illusionist description
	STRING_SET ~24294~ @1314 //new illusionist description
	STRING_SET ~9569~ @1315 //new invoker description
	STRING_SET ~24295~ @1315 //new invoker description
	STRING_SET ~9570~ @1316 //new necromancer description
	STRING_SET ~24296~ @1316 //new necromancer description
	STRING_SET ~9571~ @1317 //new transmuter description
	STRING_SET ~24297~ @1317 //new transmuter description
END

ACTION_IF GAME_IS ~iwdee~ THEN BEGIN 
	STRING_SET ~9564~ @1310 //new abjurer description
	STRING_SET ~37193~ @1310 //new abjurer description
	STRING_SET ~9565~ @1311 //new conjurer description
	STRING_SET ~37196~ @1311 //new conjurer description
	STRING_SET ~9566~ @1312 //new diviner description
	STRING_SET ~37199~ @1312 //new diviner description
	STRING_SET ~9567~ @1313 //new enchanter description
	STRING_SET ~37202~ @1313 //new enchanter description
	STRING_SET ~9568~ @1314 //new illusionist description
	STRING_SET ~37205~ @1314 //new illusionist description
	STRING_SET ~9569~ @1315 //new invoker description
	STRING_SET ~37208~ @1315 //new invoker description
	STRING_SET ~9570~ @1316 //new necromancer description
	STRING_SET ~37211~ @1316 //new necromancer description
	STRING_SET ~9571~ @1317 //new transmuter description
	STRING_SET ~37214~ @1317 //new transmuter description
END

//red wizard (abj/con) class
ADD_KIT ~QDMGRED1~
	~QDMGRED1 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED1 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED1 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED1 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED1 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED1 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED1 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED1 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED1.2da~ //CLAB
	~~ 
	~0x000040C0	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1102

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1102)
		STR_VAR
			kit_name = QDMGRED1
	END
END 

//red wizard (alt/con) class
ADD_KIT ~QDMGRED2~
	~QDMGRED2 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED2 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED2 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED2 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED2 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED2 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED2 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED2 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED2.2da~ //CLAB
	~~ 
	~0x00006080	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1103

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1103)
		STR_VAR
			kit_name = QDMGRED2
	END
END

//red wizard (alt/enc) class
ADD_KIT ~QDMGRED3~
	~QDMGRED3 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED3 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED3 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED3 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED3 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED3 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED3 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED3 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED3.2da~ //CLAB
	~~ 
	~0x00006200	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1104

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1104)
		STR_VAR
			kit_name = QDMGRED3
	END
END

//red wizard (enc/nec) class
ADD_KIT ~QDMGRED4~
	~QDMGRED4 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED4 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED4 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED4 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED4 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED4 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED4 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED4 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED4.2da~ //CLAB
	~~ 
	~0x00005200	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1105

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1105)
		STR_VAR
			kit_name = QDMGRED4
	END
END

//red wizard (nec/ill) class
ADD_KIT ~QDMGRED5~
	~QDMGRED5 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED5 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED5 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED5 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED5 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED5 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED5 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED5 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED5.2da~ //CLAB
	~~ 
	~0x00005400	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1106

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1106)
		STR_VAR
			kit_name = QDMGRED5
	END
END

//red wizard (evo/ill) class
ADD_KIT ~QDMGRED6~
	~QDMGRED6 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED6 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED6 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED6 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED6 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED6 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED6 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED6 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED6.2da~ //CLAB
	~~ 
	~0x00004C00	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1107

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1107)
		STR_VAR
			kit_name = QDMGRED6
	END
END

//red wizard (abj/evo) class
ADD_KIT ~QDMGRED7~
	~QDMGRED7 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGRED7 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGRED7 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGRED7 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGRED7 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGRED7 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGRED7 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGRED7 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGRED7.2da~ //CLAB
	~~ 
	~0x00004840	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1100
	SAY @1101
	SAY @1108

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1108)
		STR_VAR
			kit_name = QDMGRED7
	END
END

//pyromancer kit 
ADD_KIT ~QDMGPYRO~
	~QDMGPYRO 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGPYRO 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGPYRO 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGPYRO 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGPYRO 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGPYRO 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGPYRO 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGPYRO 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGPYRO.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1120
	SAY @1121
	SAY @1122

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1122)
		STR_VAR
			kit_name = QDMGPYRO
	END
END

//aeromancer kit 
ADD_KIT ~QDMGAERO~
	~QDMGAERO 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGAERO 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGAERO 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGAERO 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGAERO 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGAERO 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGAERO 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGAERO 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGAERO.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1123
	SAY @1124
	SAY @1125

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1125)
		STR_VAR
			kit_name = QDMGAERO
	END
END

//geomancer kit 
ADD_KIT ~QDMGGEOM~
	~QDMGGEOM 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGGEOM 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGGEOM 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGGEOM 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGGEOM 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGGEOM 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGGEOM 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGGEOM 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGGEOM.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1126
	SAY @1127
	SAY @1128

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1128)
		STR_VAR
			kit_name = QDMGGEOM
	END
END

//hydromancer kit 
ADD_KIT ~QDMGHYDR~
	~QDMGHYDR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHYDR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHYDR 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHYDR 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHYDR 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHYDR 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHYDR 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGHYDR 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHYDR.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1129
	SAY @1130
	SAY @1131

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1131)
		STR_VAR
			kit_name = QDMGHYDR
	END
END

//argent savant (evo) kit 
ADD_KIT ~QDMGARG1~
	~QDMGARG1 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGARG1 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGARG1 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGARG1 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGARG1 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGARG1 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGARG1 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGARG1 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGARGT.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1132
	SAY @1133
	SAY @1134

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1134)
		STR_VAR
			kit_name = QDMGARG1
	END
END

//argent savant (abj) kit 
ADD_KIT ~QDMGARG2~
	~QDMGARG2 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGARG2 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGARG2 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGARG2 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGARG2 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGARG2 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGARG2 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGARG2 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGARGT.2da~ //CLAB
	~~ 
	~0x00004040	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1132
	SAY @1133
	SAY @1135

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1135)
		STR_VAR
			kit_name = QDMGARG2
	END
END


//shadow adept (ench,ill,nec) kit
ADD_KIT ~QDMGSHDW~
	~QDMGSHDW 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGSHDW 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGSHDW 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGSHDW 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGSHDW 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGSHDW 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGSHDW 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGSHDW 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGSHDW.2da~ //CLAB
	~~ 
	~0x00005600	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1142
	SAY @1143
	SAY @1144

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1144)
		STR_VAR
			kit_name = QDMGSHDW
	END
END

//transmogrifist (alt) kit
ADD_KIT ~QDMGTRNS~
	~QDMGTRNS 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGTRNS 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGTRNS 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGTRNS 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGTRNS 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGTRNS 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGTRNS 0 0 0 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGTRNS 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGTRNS.2da~ //CLAB
	~~ 
	~0x00006000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1145
	SAY @1146
	SAY @1147

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1147)
		STR_VAR
			kit_name = QDMGTRNS
	END
END

//star metal adept (alt) kit 
ADD_KIT ~QDMGSTAR~
	~QDMGSTAR 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGSTAR 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGSTAR 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGSTAR 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGSTAR 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGSTAR 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGSTAR 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGSTAR 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGSTAR.2da~ //CLAB
	~~ 
	~0x00006000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1148
	SAY @1149
	SAY @1150

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1150)
		STR_VAR
			kit_name = QDMGSTAR
			hpclass = HPPRS
	END
END

//pale master (nec) kit
ADD_KIT ~QDMGPALE~
	~QDMGPALE 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGPALE 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGPALE 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGPALE 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGPALE 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGPALE 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGPALE 0 1 1 0 1 1 0 1 1~ //alignmnt.2da
	~QDMGPALE 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGPALE.2da~ //CLAB
	~~ 
	~0x00005000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1151
	SAY @1152
	SAY @1153

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1153)
		STR_VAR
			kit_name = QDMGPALE
			hpclass = HPROG
	END
END

//white necromancer (nec) kit
ADD_KIT ~QDMGWNEC~
	~QDMGWNEC 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGWNEC 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGWNEC 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGWNEC 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGWNEC 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGWNEC 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGWNEC 0 0 0 1 1 1 1 1 1~ //alignmnt.2da
	~QDMGWNEC 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGWNEC.2da~ //CLAB
	~~ 
	~0x00005000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1154
	SAY @1155
	SAY @1156

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1156)
		STR_VAR
			kit_name = QDMGWNEC
			hpclass = HPROG
	END
END

//harper mage (abj) kit
ADD_KIT ~QDMGHRP1~
	~QDMGHRP1 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP1 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP1 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP1 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP1 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP1 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP1 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP1 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00004040	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1202

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1202)
		STR_VAR
			kit_name = QDMGHRP1
	END
END

//harper mage (con) kit
ADD_KIT ~QDMGHRP2~
	~QDMGHRP2 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP2 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP2 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP2 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP2 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP2 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP2 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP2 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00004080	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1203

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1203)
		STR_VAR
			kit_name = QDMGHRP2
	END
END

//harper mage (alt) kit
ADD_KIT ~QDMGHRP3~
	~QDMGHRP3 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP3 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP3 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP3 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP3 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP3 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP3 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP3 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00006000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1204

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1204)
		STR_VAR
			kit_name = QDMGHRP3
	END
END

//harper mage (enc) kit
ADD_KIT ~QDMGHRP4~
	~QDMGHRP4 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP4 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP4 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP4 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP4 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP4 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP4 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP4 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00004200	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1205

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1205)
		STR_VAR
			kit_name = QDMGHRP4
	END
END

//harper mage (nec) kit
ADD_KIT ~QDMGHRP5~
	~QDMGHRP5 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP5 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP5 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP5 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP5 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP5 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP5 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP5 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00005000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1206

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1206)
		STR_VAR
			kit_name = QDMGHRP5
	END
END

//harper mage (ill) kit
ADD_KIT ~QDMGHRP6~
	~QDMGHRP6 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP6 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP6 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP6 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP6 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP6 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP6 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP6 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00004400	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1207

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1207)
		STR_VAR
			kit_name = QDMGHRP6
	END
END

//harper mage (evo) kit
ADD_KIT ~QDMGHRP7~
	~QDMGHRP7 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMGHRP7 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMGHRP7 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMGHRP7 0 0 0 0 0 0~ //abclsmod.2da
	~QDMGHRP7 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMGHRP7 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMGHRP7 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMGHRP7 1 1 0 1 0 0~ //dualclas.2da
	~TomeAndBlood/data/mage_kits/QDMGHARP.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1200
	SAY @1201
	SAY @1208

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1208)
		STR_VAR
			kit_name = QDMGHRP7
	END
END

//mage kit abilities
COPY ~TomeAndBlood/data/mage_kits/SPL/QDMGRED1.SPL~ ~override~ //red wizard +1 spell per level 

	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHRP1.SPL~ ~override~ //harper mage +2 lore per level
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHRP2.SPL~ ~override~ //harper mage +2 saves vs. spells
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHRP3.SPL~ ~override~ //harper mage imm. to silence
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGARG1.SPL~ ~override~ //argent savant base AC: 7
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGARG2.SPL~ ~override~ //argent savant +10% MDR 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGARG3.SPL~ ~override~ //argent savant +15% MDR
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGARG4.SPL~ ~override~ //argent savant +25% MDR 
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPYR1.SPL~ ~override~ //pyro +10% fire resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPYR2.SPL~ ~override~ //pyro +D4 fire damage spl
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPYR2.EFF~ ~override~ //pyro +D4 fire damage eff
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPYR3.SPL~ ~override~ //pyro +15% fire resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPYR4.SPL~ ~override~ //pyro +25% fire resistance 
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGAER1.SPL~ ~override~ //aero +10% electric resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGAER2.SPL~ ~override~ //aero +D4 electric damage spl
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGAER2.EFF~ ~override~ //aero +D4 electric damage eff
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGAER3.SPL~ ~override~ //aero +15% electric resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGAER4.SPL~ ~override~ //aero +25% electric resistance 
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGGEO1.SPL~ ~override~ //geo +10% acid resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGGEO2.SPL~ ~override~ //geo +D4 acid damage spl
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGGEO2.EFF~ ~override~ //geo +D4 acid damage eff
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGGEO3.SPL~ ~override~ //geo +15% acid resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGGEO4.SPL~ ~override~ //geo +25% acid resistance 
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHYD1.SPL~ ~override~ //hydro +10% cold resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHYD2.SPL~ ~override~ //hydro +D4 cold damage spl
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHYD2.EFF~ ~override~ //hydro +D4 cold damage eff
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHYD3.SPL~ ~override~ //hydro +15% cold resistance 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGHYD4.SPL~ ~override~ //hydro +25% cold resistance
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGWNC1.SPL~ ~override~ //white necro bonus spells 
	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPLE1.SPL~ ~override~ //pale master imm to sleep, backstab
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPLE2.SPL~ ~override~ //pale master +1 to saves vs. death
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPLE3.SPL~ ~override~ //pale master +1 to Armor Class
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGPLE4.SPL~ ~override~ //pale master imm to death magic
	 	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMG!BNS.SPL~ ~override~ //removing bonus spell slot
	 	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR1.SPL~ ~override~ //starmetal adept +1 AC, THAC0
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR2.SPL~ ~override~ //starmetal adept fists
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR3.SPL~ ~override~ //starmetal adept +2 saves vs death
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR4.SPL~ ~override~ //starmetal adept imm backstab
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR5.SPL~ ~override~ //starmetal adept 20% phys res
	 	 
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSHD1.SPL~ ~override~ //shadow adept imm blind, infravision
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSHD2.SPL~ ~override~ //shadow adept casting speed condition
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSHDA.SPL~ ~override~ //shadow adept casting speed bonus
	 ~TomeAndBlood/data/mage_kits/SPL/QDMGSHD3.SPL~ ~override~ //shadow adept non-detection
	 	
COPY ~TomeAndBlood/data/mage_kits/SPL/QDMGSTR2.ITM~ ~override~ //starmetal fists
		SAY NAME1 @1300
		SAY NAME2 @1300 
		
		
COPY_EXISTING ~SPCL634.SPL~ ~override/QDMGTRN1.SPL~ //transmogrifist fire sala
			  ~SPCL633.SPL~ ~override/QDMGTRN2.SPL~ //transmogrifist wyvern
			  ~SPCL632.SPL~ ~override/QDMGTRN3.SPL~ //transmogrifist Sword spider
			  ~SPSD02.SPL~  ~override/QDMGSHD4.SPL~ //shadow adept shadow step

//code that allows for mages to select kits
COMPILE ~TomeAndBlood/data/mage_kits/QDMGKIT.D~ ~override~ //MAGE KIT DECLARATION DIALOG
COMPILE ~TomeAndBlood/data/mage_kits/QDMGKIT.BAF~ ~override~ //MAGE KIT DECLARATION SCRIPT

COPY ~TomeAndBlood/data/mage_kits/QDMGKIT.CRE~ ~override~   //choose kit creature 

COPY ~TomeAndBlood/data/mage_kits/QDMGKIT.SPL~ ~override~   //choose kit spell 
  SAY NAME1 @1110
  SAY UNIDENTIFIED_DESC @1111
  
//fake specialist kits for NPCs 

COPY_EXISTING ~CLABMA02.2da~ ~override/QDMG_ABJ.2da~ //abjurer
			  ~CLABMA03.2da~ ~override/QDMG_NEC.2da~ //necromancer
			  ~CLABMA04.2da~ ~override/QDMG_ALT.2da~ //transmuter
			  ~CLABMA06.2da~ ~override/QDMG_CON.2da~ //conjurer
			  ~CLABMA07.2da~ ~override/QDMG_EVO.2da~ //invoker
			  ~CLABMA08.2da~ ~override/QDMG_ILL.2da~ //illusionist
			  ~CLABMA09.2da~ ~override/QDMG_ENC.2da~ //enchanter	
					REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~GA_QDMGKIT~ ~****      ~
					
ADD_KIT ~QDMG_ABJ~
	~QDMG_ABJ 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_ABJ 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_ABJ 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_ABJ 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_ABJ 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_ABJ 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_ABJ 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_ABJ 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_ABJ.2da~ //CLAB
	~~ 
	~0x00004040	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1330
	SAY @1340
	SAY @1320

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1320)
		STR_VAR
			kit_name = QDMG_ABJ
	END
END
  
ADD_KIT ~QDMG_CON~
	~QDMG_CON 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_CON 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_CON 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_CON 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_CON 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_CON 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_CON 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_CON 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_CON.2da~ //CLAB
	~~ 
	~0x00004080	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1331
	SAY @1341
	SAY @1321

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1321)
		STR_VAR
			kit_name = QDMG_CON
	END
END

ADD_KIT ~QDMG_ENC~
	~QDMG_ENC 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_ENC 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_ENC 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_ENC 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_ENC 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_ENC 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_ENC 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_ENC 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_ENC.2da~ //CLAB
	~~ 
	~0x00004200	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1332
	SAY @1342
	SAY @1322

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1322)
		STR_VAR
			kit_name = QDMG_ENC
	END
END

ADD_KIT ~QDMG_ILL~
	~QDMG_ILL 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_ILL 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_ILL 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_ILL 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_ILL 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_ILL 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_ILL 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_ILL 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_ILL.2da~ //CLAB
	~~ 
	~0x00004400	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1333
	SAY @1343
	SAY @1323

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1323)
		STR_VAR
			kit_name = QDMG_ILL
	END
END

ADD_KIT ~QDMG_EVO~
	~QDMG_EVO 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_EVO 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_EVO 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_EVO 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_EVO 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_EVO 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_EVO 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_EVO 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_EVO.2da~ //CLAB
	~~ 
	~0x00004800	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1334
	SAY @1344
	SAY @1324

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1324)
		STR_VAR
			kit_name = QDMG_EVO
	END
END

ADD_KIT ~QDMG_NEC~
	~QDMG_NEC 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_NEC 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_NEC 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_NEC 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_NEC 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_NEC 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_NEC 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_NEC 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_NEC.2da~ //CLAB
	~~ 
	~0x00005000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1335
	SAY @1345
	SAY @1325

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1325)
		STR_VAR
			kit_name = QDMG_NEC
	END
END

ADD_KIT ~QDMG_ALT~
	~QDMG_ALT 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDMG_ALT 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDMG_ALT 0 0 0 9 0 0~ //abclasrq.2da 
	~QDMG_ALT 0 0 0 0 0 0~ //abclsmod.2da
	~QDMG_ALT 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDMG_ALT 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDMG_ALT 1 1 0 1 1 0 1 1 0~ //alignmnt.2da
	~QDMG_ALT 1 1 0 1 0 0~ //dualclas.2da
	~override/QDMG_ALT.2da~ //CLAB
	~~ 
	~0x00006000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @1336
	SAY @1346
	SAY @1326

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@1326)
		STR_VAR
			kit_name = QDMG_ALT
	END
END  

COPY_EXISTING_REGEXP GLOB ~^.+\.cre$~ ~override~ //updating npc kits
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
    READ_LONG 0x244 "kit" ELSE 0
    PATCH_IF ("%kit%" = 0x00400000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_ABJ" + 0x4000)
	END
	PATCH_IF ("%kit%" = 0x00800000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_CON" + 0x4000)
	END
	PATCH_IF ("%kit%" = 0x02000000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_ENC" + 0x4000) 
	END
	PATCH_IF ("%kit%" = 0x04000000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_ILL" + 0x4000) 
	END
	PATCH_IF ("%kit%" = 0x08000000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_EVO" + 0x4000) 
	END
	PATCH_IF ("%kit%" = 0x10000000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_NEC" + 0x4000) 
	END
	PATCH_IF ("%kit%" = 0x20000000) BEGIN
        WRITE_SHORT 0x246 ("QDMG_ALT" + 0x4000)
	END
	
END
BUT_ONLY 


//updates if Armored Casting and Expanded Weapons are installed 
ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb03.qd~) THEN BEGIN //check for armored casting component	

	ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb04.qd~) THEN BEGIN //check for expanded weapons 
		//arcanamach
		ADD_KIT ~QDMGARMC~
			~QDMGARMC 1 0 0 1 1 0 0 0~ //clasweap.2da
			~QDMGARMC 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
			~QDMGARMC 0 0 0 9 0 0~ //abclasrq.2da 
			~QDMGARMC 0 0 0 0 0 0~ //abclsmod.2da
			~QDMGARMC 0 0 0 17 0 0~ //abdcdsrq.2da
			~QDMGARMC 0 0 0 15 0 0~ //abdcscrq.2da 
			~QDMGARMC 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
			~QDMGARMC 0 0 0 0 0 0~ //dualclas.2da
			~TomeAndBlood/data/mage_kits/QDMGARMC.2da~ //CLAB
			~~ 
			~0x00004040	1~ 
			~MA0~ 
			~* * * * * * * * * * * * * * * * * * * *~
			SAY @1136
			SAY @1137
			SAY @1138

		ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
			LAF fl#add_kit_ee
				INT_VAR
					briefdesc = RESOLVE_STR_REF (@1138)
				STR_VAR
					kit_name = QDMGARMC
					hpclass = HPROG
			END
		END

		//battlemage (evo) kit 
		ADD_KIT ~QDMGBTTL~
			~QDMGBTTL 1 0 0 1 1 0 0 0~ //clasweap.2da
			~QDMGBTTL 0 1 0 1 1 0 0 1 0 0 0 0 0 0 0 1 0 1 1 0 0 0 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
			~QDMGBTTL 0 0 0 9 0 0~ //abclasrq.2da 
			~QDMGBTTL 0 0 0 0 0 0~ //abclsmod.2da
			~QDMGBTTL 0 0 0 17 0 0~ //abdcdsrq.2da
			~QDMGBTTL 0 0 0 15 0 0~ //abdcscrq.2da 
			~QDMGBTTL 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
			~QDMGBTTL 0 0 0 0 0 0~ //dualclas.2da
			~TomeAndBlood/data/mage_kits/QDMGBTTL.2da~ //CLAB
			~~ 
			~0x00004800	1~ 
			~MA0~ 
			~* * * * * * * * * * * * * * * * * * * *~
			SAY @1139
			SAY @1140
			SAY @1141

		ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
			LAF fl#add_kit_ee
				INT_VAR
					briefdesc = RESOLVE_STR_REF (@1141)
				STR_VAR
					kit_name = QDMGBTTL
					hpclass = HPROG
			END
		END
					  
		COPY ~TomeAndBlood/data/mage_kits/SPL/QDMGAMC2.SPL~ ~override~ //arcanamach dispelling strike
				SAY NAME1 @1301
				SAY UNIDENTIFIED_DESC @1302 

		COPY ~TomeAndBlood/data/mage_kits/SPL/QDMGAMC1.SPL~ ~override~ //arcanamach no shields
			 ~TomeAndBlood/data/mage_kits/SPL/QDMGAMCA.EFF~ ~override~ //arcanamach dispel effect
			 ~TomeAndBlood/data/mage_kits/SPL/QDMGBTL1.SPL~ ~override~ //battlemage min damage bonus
		
	END
	
	COPY_EXISTING ~QDMGHARP.2da~ ~override~ //harper mage
			      ~QDMGAERO.2da~ ~override~ //aeromancer
			      ~QDMGARGT.2da~ ~override~ //argent savant
			      ~QDMGGEOM.2da~ ~override~ //geomancer
			      ~QDMGHYDR.2da~ ~override~ //hydromancer
			      ~QDMGPALE.2da~ ~override~ //pale master
			      ~QDMGPYRO.2da~ ~override~ //pyromancer
			      ~QDMGSHDW.2da~ ~override~ //shadow adept
			      ~QDMGSTAR.2da~ ~override~ //starmetal adept
			      ~QDMGTRNS.2da~ ~override~ //transmogrifist
			      ~QDMGWNEC.2da~ ~override~ //white necromancer
			      ~QDMGRED1.2da~ ~override~ //red wizard
			      ~QDMGRED2.2da~ ~override~ //red wizard
			      ~QDMGRED3.2da~ ~override~ //red wizard
			      ~QDMGRED4.2da~ ~override~ //red wizard
			      ~QDMGRED5.2da~ ~override~ //red wizard
			      ~QDMGRED6.2da~ ~override~ //red wizard
			      ~QDMGRED7.2da~ ~override~ //red wizard
			      				   
						INSERT_2DA_ROW 3 0 ~ARMRCAST AP_QDACNO ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~ 

	COMPILE ~TomeAndBlood/data/mage_kits/expanded/QDMGKIT.D~ ~override~ //MAGE KIT DECLARATION DIALOG with battlemage and arcanamach
END 

//updates if Arcane Crafting is installed
ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb05.qd~) THEN BEGIN //check for arcane crafting component	
	COPY_EXISTING ~QDMGHARP.2da~ ~override~ //harper mage
				  ~QDMGAERO.2da~ ~override~ //aeromancer
				  ~QDMGARGT.2da~ ~override~ //argent savant
				  ~QDMGGEOM.2da~ ~override~ //geomancer
				  ~QDMGHYDR.2da~ ~override~ //hydromancer
				  ~QDMGPALE.2da~ ~override~ //pale master
				  ~QDMGPYRO.2da~ ~override~ //pyromancer
				  ~QDMGSHDW.2da~ ~override~ //shadow adept
				  ~QDMGSTAR.2da~ ~override~ //starmetal adept
				  ~QDMGTRNS.2da~ ~override~ //transmogrifist
				  ~QDMGWNEC.2da~ ~override~ //white necromancer
				  ~QDMGRED1.2da~ ~override~ //red wizard
				  ~QDMGRED2.2da~ ~override~ //red wizard
				  ~QDMGRED3.2da~ ~override~ //red wizard
				  ~QDMGRED4.2da~ ~override~ //red wizard
				  ~QDMGRED5.2da~ ~override~ //red wizard
				  ~QDMGRED6.2da~ ~override~ //red wizard
				  ~QDMGRED7.2da~ ~override~ //red wizard
					INSERT_2DA_ROW 3 0 ~ARCNCRFT GA_B_SCRIB	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~

	COPY_EXISTING ~QDMG_ABJ.2da~ ~override~ //npc abjurer
				  ~QDMG_CON.2da~ ~override~ //npc conjurer				
				  ~QDMG_ENC.2da~ ~override~ //npc enchanter				
				  ~QDMG_ILL.2da~ ~override~ //npc illusionist				
				  ~QDMG_EVO.2da~ ~override~ //npc invoker				
				  ~QDMG_NEC.2da~ ~override~ //npc necromancer				
				  ~QDMG_ALT.2da~ ~override~ //npc transmuter							
				   INSERT_2DA_ROW 3 0 ~ARCNCRFT GA_B_SCRIB	 ****       ****       ****       GA_B_BREW1 ****       ****       ****       ****       GA_B_WAND1      ****       ****       ****       ****       GA_B_RECH1 ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****       ****~	
END

//-----------------------------
// COMPATIBILITY WITH MORE STYLE FOR WIZARDS by PECCA 
//-----------------------------

ACTION_IF FILE_EXISTS_IN_GAME ~WSSPELLS.SPL~ THEN BEGIN  //checking for MSFM 
	COMPILE ~TomeAndBlood/data/compatibility/QD_MSFM_fix_9A.D~ 	 
	COMPILE ~TomeAndBlood/data/compatibility/QD_MSFM_fix_9B.D~ 	 
END 

// ---------------------------------------------------
// ALLOW JOINABLE NPCS TO SELECT SPECIALIST MAGE KITS
// ---------------------------------------------------
BEGIN @2100
GROUP ~NPC Changes~ 
DESIGNATED 10
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~9~ @1903 //requires mages kitpack
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee~) @1902	

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb10.qd~ //detection for this component

OUTER_SET QDMG_ABJ = IDS_OF_SYMBOL (KIT ~QDMG_ABJ~) 
OUTER_SET QDMG_CON = IDS_OF_SYMBOL (KIT ~QDMG_CON~) 
OUTER_SET QDMG_ENC = IDS_OF_SYMBOL (KIT ~QDMG_ENC~) 
OUTER_SET QDMG_ILL = IDS_OF_SYMBOL (KIT ~QDMG_ILL~) 
OUTER_SET QDMG_EVO = IDS_OF_SYMBOL (KIT ~QDMG_EVO~) 
OUTER_SET QDMG_NEC = IDS_OF_SYMBOL (KIT ~QDMG_NEC~) 
OUTER_SET QDMG_ALT = IDS_OF_SYMBOL (KIT ~QDMG_ALT~) 
	 
ACTION_IF (GAME_IS ~bgee~) THEN BEGIN //check for BGEE	
	COPY_EXISTING_REGEXP ~DYNAHE.*\.CRE~ ~override~
				  ~XAN.*\.CRE~ ~override~
				  ~EDWIN.*\.CRE~ ~override~
				  ~XZAR.*\.CRE~ ~override~
				  ~QUAYLE.*\.CRE~ ~override~
				  
	PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
		READ_SHORT 0x246 "kit" ELSE 0
		PATCH_IF ("%kit%" = "%QDMG_ABJ%") BEGIN
			WRITE_SHORT 0x246 0x0040
		END
		PATCH_IF ("%kit%" = "%QDMG_CON%") BEGIN
			WRITE_SHORT 0x246 0x0080
		END
		PATCH_IF ("%kit%" = "%QDMG_ENC%") BEGIN
			WRITE_SHORT 0x246 0x200 
		END
		PATCH_IF ("%kit%" = "%QDMG_ILL%") BEGIN
			WRITE_SHORT 0x246 0x0400
		END
		PATCH_IF ("%kit%" = "%QDMG_EVO%") BEGIN
			WRITE_SHORT 0x246 0x0800
		END
		PATCH_IF ("%kit%" = "%QDMG_NEC%") BEGIN
			WRITE_SHORT 0x246 0x1000
		END
		PATCH_IF ("%kit%" = "%QDMG_ALT%") BEGIN
			WRITE_SHORT 0x246 0x2000
		END
	
	END 
	BUT_ONLY 
END 

ACTION_IF (GAME_IS ~bg2ee~) THEN BEGIN //check for BG2EE	
	COPY_EXISTING_REGEXP ~JAN.*\.CRE~ ~override~
				  ~EDWIN.*\.CRE~ ~override~		  
	PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
		READ_SHORT 0x246 "kit" ELSE 0
		PATCH_IF ("%kit%" = "%QDMG_ABJ%") BEGIN
			WRITE_SHORT 0x246 0x0040
		END
		PATCH_IF ("%kit%" = "%QDMG_CON%") BEGIN
			WRITE_SHORT 0x246 0x0080
		END
		PATCH_IF ("%kit%" = "%QDMG_ENC%") BEGIN
			WRITE_SHORT 0x246 0x200 
		END
		PATCH_IF ("%kit%" = "%QDMG_ILL%") BEGIN
			WRITE_SHORT 0x246 0x0400
		END
		PATCH_IF ("%kit%" = "%QDMG_EVO%") BEGIN
			WRITE_SHORT 0x246 0x0800
		END
		PATCH_IF ("%kit%" = "%QDMG_NEC%") BEGIN
			WRITE_SHORT 0x246 0x1000
		END
		PATCH_IF ("%kit%" = "%QDMG_ALT%") BEGIN
			WRITE_SHORT 0x246 0x2000
		END
	
	END 
	BUT_ONLY 
END 

// ---------------------------------------------------
// ALLOW JOINABLE NPCS TO SELECT BLOODLINE KITS
// ---------------------------------------------------
BEGIN @2110
GROUP ~NPC Changes~ 
DESIGNATED 11
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~0~ @100 //requires Core Revisions
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~6~ @1904 //requires bloodlines kitpack
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee~) @1902	

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb11.qd~ //detection for this component

OUTER_SET QDELDSOR = IDS_OF_SYMBOL (KIT ~QDELDSOR~) 
	 
ACTION_IF (GAME_IS ~bgee~) THEN BEGIN //check for BGEE	
	COPY_EXISTING_REGEXP ~BAELOTH.*\.CRE~ ~override~
				  				  
	PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
		READ_SHORT 0x246 "kit" ELSE 0
		PATCH_IF ("%kit%" = "%QDELDSOR%") BEGIN
			WRITE_SHORT 0x246 0x0000
		END
	
	END 
	BUT_ONLY 
END 

ACTION_IF (GAME_IS ~bg2ee~) THEN BEGIN //check for BG2EE	
	 //currently no sorcerers
END 

// -----------------------------
// XAN BLADESINGER KIT 
// -----------------------------		
BEGIN @1910
GROUP ~NPC Changes~ 
DESIGNATED 12
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~3~ @602 //requires Armored Casting 
REQUIRE_PREDICATE (GAME_IS ~bgee~) @1900	

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb12.qd~ //detection for this component

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

//bladesinger (xan) kit 
ADD_KIT ~QDXAN~
	~QDXAN 1 0 0 1 1 0 0 0~ //clasweap.2da
	~QDXAN 1 1 0 0 1 0 0 1 0 0 0 0 0 0 0 3 0 1 0 0 0 0 1 1 0 0 1 1 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDXAN 0 0 0 9 0 0~ //abclasrq.2da 
	~QDXAN 0 0 0 0 0 0~ //abclsmod.2da
	~QDXAN 0 0 0 17 0 0~ //abdcdsrq.2da
	~QDXAN 0 0 0 15 0 0~ //abdcscrq.2da 
	~QDXAN 1 1 1 1 1 1 1 1 1~ //alignmnt.2da
	~QDXAN 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/npcs/QDXAN.2da~ //CLAB
	~~ 
	~0x00004000	1~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @2000
	SAY @2001
	SAY @2002

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@2002)
		STR_VAR
			kit_name = QDXAN
			hpclass = HPPRS
	END
END		

COPY ~TomeAndBlood/data/npcs/QDXAN1.SPL~ ~override~ //no shields 
	 ~TomeAndBlood/data/npcs/QDXAN2.SPL~ ~override~ //+1 to hit  
	 ~TomeAndBlood/data/npcs/QDXAN3.SPL~ ~override~ //-2 casting speed penalty
	 ~TomeAndBlood/data/npcs/QDXAN4.SPL~ ~override~ //-4 to hit and damage elves
 
EXTEND_BOTTOM ~XAN.BCS~ ~TomeAndBlood/data/npcs/XAN_BLADESINGER.BAF~ 

// -----------------------------
// DYNAHEIR KIT CHOICES
// -----------------------------		
BEGIN @1920
GROUP ~NPC Changes~ 
DESIGNATED 13
SUBCOMPONENT ~Dynaheir: Options~
REQUIRE_PREDICATE (GAME_IS ~bgee~) @1900	

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb13.qd~ //detection for this component

INCLUDE ~TomeAndBlood/lib/fl#add_kit_ee.tpa~

//hathran (dynaheir) kit 
ADD_KIT ~QDDYNAHE~
	~QDDYNAHE 0 0 0 1 1 0 0 0~ //clasweap.2da
	~QDDYNAHE 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~ //weapprof.2da 
	~QDDYNAHE 0 0 0 0 0 9~ //abclasrq.2da 
	~QDDYNAHE 0 0 0 0 0 0~ //abclsmod.2da
	~QDDYNAHE 0 0 0 0 0 17~ //abdcdsrq.2da
	~QDDYNAHE 0 0 0 0 0 15~ //abdcscrq.2da 
	~QDDYNAHE 1 1 0 1 0 0 0 0 0~ //alignmnt.2da
	~QDDYNAHE 0 0 0 0 0 0~ //dualclas.2da
	~TomeAndBlood/data/npcs/QDDYNAHE.2da~ //CLAB
	~~ 
	~0x00004000	19~ 
	~MA0~ 
	~* * * * * * * * * * * * * * * * * * * *~
	SAY @2010
	SAY @2011
	SAY @2012

ACTION_IF GAME_IS ~bgee bg2ee iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@2012)
		STR_VAR
			kit_name = QDDYNAHE
	END
END		

COPY ~TomeAndBlood/data/npcs/QDDYNA1.SPL~ ~override~ //bonus spells 
	 ~TomeAndBlood/data/npcs/QDDYNA2.SPL~ ~override~ //-1 casting speed penalty
	 ~TomeAndBlood/data/npcs/QDDYNA3.SPL~ ~override~ //+2 saves
	 ~TomeAndBlood/data/npcs/QDDYNA4.SPL~ ~override~ //removes eldritch sor spells if necessary
	  
EXTEND_BOTTOM ~DYNAHEIR.BCS~ ~TomeAndBlood/data/npcs/DYNAHEIR_HATHRAN.BAF~ 

COPY_EXISTING ~DYNAHE.CRE~ ~override~
			  ~DYNAHE2.CRE~ ~override~
			  ~DYNAHE4.CRE~ ~override~
			  ~DYNAHE6.CRE~ ~override~
	WRITE_BYTE 0x273 19 //change to sorcerer
	
BEGIN @1921 
SUBCOMPONENT ~Dynaheir: Options~ 
DESIGNATED 14 

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb14.qd~ //detection for this component

ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb11.qd~ || NOT FILE_EXISTS_IN_GAME ~qdtnb06.qd~) THEN BEGIN //check for bloodlines for npcs 
	EXTEND_BOTTOM ~DYNAHEIR.BCS~ ~TomeAndBlood/data/npcs/DYNAHEIR_SORCERER.BAF~
END 

ELSE BEGIN 
	EXTEND_BOTTOM ~DYNAHEIR.BCS~ ~TomeAndBlood/data/npcs/DYNAHEIR_ELD_SOR.BAF~ //makes dynaheir an eld sor by default
END

COPY_EXISTING ~DYNAHE.CRE~ ~override~
			  ~DYNAHE2.CRE~ ~override~
			  ~DYNAHE4.CRE~ ~override~
			  ~DYNAHE6.CRE~ ~override~
	WRITE_BYTE 0x273 19 //change to sorcerer
	
// -----------------------------
// EDWIN RED WIZARD KIT
// -----------------------------		
BEGIN @1930
GROUP ~NPC Changes~ 
SUBCOMPONENT ~Edwin: Options~
DESIGNATED 15 
REQUIRE_COMPONENT ~setup-tomeandblood.tp2~ ~9~ @1903 //requires mages kitpack
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee~) @1902	
	  
COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb15.qd~ //detection for this component

EXTEND_BOTTOM ~EDWIN.BCS~ ~TomeAndBlood/data/npcs/EDWIN_RED_ABJ.BAF~ 

BEGIN @1931 
SUBCOMPONENT ~Edwin: Options~
DESIGNATED 16

COPY_EXISTING ~sw1h01.itm~ ~override/qdtnb16.qd~ //detection for this component

EXTEND_BOTTOM ~EDWIN.BCS~ ~TomeAndBlood/data/npcs/EDWIN_RED_ALT.BAF~

